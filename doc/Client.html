<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Client - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-balance">::balance</a>
    
    <li ><a href="#method-c-cancelRetrait">::cancelRetrait</a>
    
    <li ><a href="#method-c-checkHeader">::checkHeader</a>
    
    <li ><a href="#method-c-check_retrait">::check_retrait</a>
    
    <li ><a href="#method-c-check_retrait_refactoring">::check_retrait_refactoring</a>
    
    <li ><a href="#method-c-create_user">::create_user</a>
    
    <li ><a href="#method-c-create_user_account">::create_user_account</a>
    
    <li ><a href="#method-c-credit">::credit</a>
    
    <li ><a href="#method-c-debit_client">::debit_client</a>
    
    <li ><a href="#method-c-debit_user_account">::debit_user_account</a>
    
    <li ><a href="#method-c-device">::device</a>
    
    <li ><a href="#method-c-find_client">::find_client</a>
    
    <li ><a href="#method-c-find_marchand">::find_marchand</a>
    
    <li ><a href="#method-c-get_balance">::get_balance</a>
    
    <li ><a href="#method-c-get_balance_retrait">::get_balance_retrait</a>
    
    <li ><a href="#method-c-hashAmount">::hashAmount</a>
    
    <li ><a href="#method-c-init_retrait">::init_retrait</a>
    
    <li ><a href="#method-c-isFraud-3F">::isFraud?</a>
    
    <li ><a href="#method-c-isLock-3F">::isLock?</a>
    
    <li ><a href="#method-c-is_await_valid-3F">::is_await_valid?</a>
    
    <li ><a href="#method-c-lockCustomerAccount">::lockCustomerAccount</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-pay">::pay</a>
    
    <li ><a href="#method-c-prettyCallSexe">::prettyCallSexe</a>
    
    <li ><a href="#method-c-saveHistory">::saveHistory</a>
    
    <li ><a href="#method-c-signin">::signin</a>
    
    <li ><a href="#method-c-signup">::signup</a>
    
    <li ><a href="#method-c-transfert">::transfert</a>
    
    <li ><a href="#method-c-updateDevice">::updateDevice</a>
    
    <li ><a href="#method-c-update_account_client">::update_account_client</a>
    
    <li ><a href="#method-c-update_account_marchand">::update_account_marchand</a>
    
    <li ><a href="#method-c-validate_retrait">::validate_retrait</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Client">
  <h1 id="class-Client" class="class">
    class Client
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-balance" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">balance</span><span
            class="method-args">(argv, locale)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>GET CREDIT BALANCE ACCOUNT REFACTORING</p>

<pre>@param [Object] argv</pre>
          
          

          
          <div class="method-source-code" id="balance-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 580</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">balance</span>(<span class="ruby-identifier">argv</span>, <span class="ruby-identifier">locale</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-identifier">locale</span> = <span class="ruby-identifier">locale</span>

  <span class="ruby-keyword">begin</span>

    <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotUnique</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@password</span>)
        <span class="ruby-comment"># We can now render customer amount</span>
        <span class="ruby-identifier">amount</span> = <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span>

        <span class="ruby-comment"># send SMS to customer</span>
        <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Bonjour #{@customer.complete_name} le solde de votre compte est de #{amount} FC&quot;</span>)

        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">amount</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Invalid password&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ConnectionNotEstablished</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Impossible de contacter le serveur&quot;</span>

  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-cancelRetrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cancelRetrait</span><span
            class="method-args">(argv, message=nil , locale)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>ANNULATION D UN RETRAIT DANS UN COMPTE CLIENT</p>

<pre>@method   name Cancel current retrait by user
@name     Client::cancelRetrait
@params   phone, password, awaitHash
@output   boolean [true/false]
@author @mvondoyannick
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="cancelRetrait-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1126</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">cancelRetrait</span>(<span class="ruby-identifier">argv</span>, <span class="ruby-identifier">message</span>=<span class="ruby-keyword">nil</span> , <span class="ruby-identifier">locale</span>)
  <span class="ruby-identifier">token</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:token</span>]
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">message</span>
  <span class="ruby-identifier">locale</span> = <span class="ruby-identifier">locale</span>

  <span class="ruby-comment">#searching customer</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-identifier">token</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;customerNotFound&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-identifier">locale</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># check existance of await</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Searching intents for customer #{token}&quot;</span>
    <span class="ruby-identifier">intent</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">intent</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> , <span class="ruby-string">&quot;Aucune intention de retrait disponible pour ce compte&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># we found an intent, we can destroy it</span>
      <span class="ruby-comment"># See restauration on Await model</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">intent</span>.<span class="ruby-identifier">destroy</span>
        <span class="ruby-comment"># cancel and restore customer credit account</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Retrait annulé avec succes du montant de #{intent.amount.round(2)}&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Une erreur est survenue durant le processus d&#39;annulation du retrait de #{intent.amount.round(2)} FC&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-checkHeader" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">checkHeader</span><span
            class="method-args">(header)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>AUTHENTIFICATION D UN USTOMER VIA LE HEADER RECU</p>

<pre>@method name  Check Header for customer
@name         Client::checkHeader
@params       header
@output       boolean [true/false]
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="checkHeader-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1218</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">checkHeader</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-ivar">@header</span> = <span class="ruby-identifier">header</span>
  <span class="ruby-identifier">header_customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@header</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">header_customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Impossible d&#39;authentifier le client&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;unauthenticable&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Client authentifier&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">header_customer</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> [<span class="ruby-value">:phone</span>, <span class="ruby-value">:authentication_token</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-check_retrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_retrait</span><span
            class="method-args">(phone)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>VERIFICATION DE L EXISTENCE D&#39;UNE INTENTION DE RETRAIT EN COURS</p>

<pre>@method   Check retrait | verifier le retrait
@name     Client::check_retrait
@params   phone
@output   boolean [true/false]
@author @mvondoyannick
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="check_retrait-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1161</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">check_retrait</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>) <span class="ruby-comment">#where(phone: phone).first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">await</span> = <span class="ruby-constant">Await</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">await</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Aucun retrait trouvé pour ce compte&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Aucun retrait sur votre compte  pour le moment&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Existance d&#39;un retrait pour ce compte&quot;</span>

      <span class="ruby-comment">#notification email</span>
      <span class="ruby-comment">#ApiMailer.notifyAdmin.deliver_now</span>
      <span class="ruby-comment">#ApiMailer.signupFail(&quot;MESSAGE&quot;, 691451189, Time.now, &quot;ERRORS&quot;).deliver_now</span>
      <span class="ruby-constant">ApiMailer</span>.<span class="ruby-identifier">notify</span>(<span class="ruby-string">&quot;MESSAGE&quot;</span>, <span class="ruby-value">691451189</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>, <span class="ruby-string">&quot;ERRORS&quot;</span>).<span class="ruby-identifier">deliver_now</span>
      <span class="ruby-comment"># fin notification</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">await</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> <span class="ruby-value">:amount</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-check_retrait_refactoring" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_retrait_refactoring</span><span
            class="method-args">(token, locale)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>VERIFICATION DE LA PRESENCE DE L&#39;INTENT DE RETRAIT 
<dd>
<p>REFACTORING – UPDATE</p>
</dd></dl>

<pre>@param [Object] token
@author @mvondoyannick
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="check_retrait_refactoring-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1190</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">check_retrait_refactoring</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">locale</span>)
  <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">token</span>
  <span class="ruby-identifier">locale</span> = <span class="ruby-identifier">locale</span>

  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;customerNotFound&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-identifier">locale</span>) <span class="ruby-comment">#&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#on recherche le compte await du customer</span>
    <span class="ruby-identifier">intent_retrait</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">intent_retrait</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Aucun retrait pour cet utilisateur&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;noIntent&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-identifier">locale</span>) <span class="ruby-comment">#&quot;Aucun retrait pour ce compte.&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Intent retrait trouvé&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">intent_retrait</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> <span class="ruby-value">:amount</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-create_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_user</span><span
            class="method-args">(name, prenom, phone, cni, password, sexe, ip)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CREATION DU COMPTE CLIENT</p>

<pre>@params  [String] name
@params  [String] prenom
@params  [Integer] phone
@params  [String] cni
@params  [String] password
@params  [String] sexe
@return  [Boolean] boolean
@version 1.0.0
@param [String] ip</pre>
          
          

          
          <div class="method-source-code" id="create_user-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">create_user</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">prenom</span>, <span class="ruby-identifier">phone</span>, <span class="ruby-identifier">cni</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">sexe</span>, <span class="ruby-identifier">ip</span>)
  <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@prenom</span> = <span class="ruby-identifier">prenom</span>
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@cni</span> = <span class="ruby-identifier">cni</span>
  <span class="ruby-ivar">@email</span> = <span class="ruby-node">&quot;#{@phone.to_i}@#{$domain}&quot;</span>
  <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">password</span>
  <span class="ruby-ivar">@sexe</span> = <span class="ruby-identifier">sexe</span>
  <span class="ruby-ivar">@ip</span> = <span class="ruby-identifier">ip</span>

  <span class="ruby-comment">#on recherche le pays</span>
  <span class="ruby-ivar">@pays</span> = <span class="ruby-constant">DistanceMatrix</span><span class="ruby-operator">::</span><span class="ruby-constant">DistanceMatrix</span>.<span class="ruby-identifier">pays</span>(<span class="ruby-ivar">@ip</span>)

  <span class="ruby-comment">#creation du compte de l&#39;utilisateur</span>
  <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">new</span>(
      <span class="ruby-value">name:</span> <span class="ruby-ivar">@name</span>,
      <span class="ruby-value">second_name:</span> <span class="ruby-ivar">@prenom</span>,
      <span class="ruby-value">phone:</span> <span class="ruby-ivar">@phone</span>,
      <span class="ruby-value">email:</span> <span class="ruby-ivar">@email</span>,
      <span class="ruby-value">password:</span> <span class="ruby-ivar">@password</span>,
      <span class="ruby-value">type_id:</span> <span class="ruby-value">1</span>,
      <span class="ruby-value">cni:</span> <span class="ruby-ivar">@cni</span>,
      <span class="ruby-value">sexe:</span> <span class="ruby-ivar">@sexe</span>,
      <span class="ruby-value">ip:</span> <span class="ruby-ivar">@ip</span>,
      <span class="ruby-value">pays:</span> <span class="ruby-ivar">@pays</span>
  )

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> {<span class="ruby-node">&quot;Creation de de l&#39;utiliateur #{@phone} avec succes.&quot;</span>}

    <span class="ruby-comment">#on envoi le code d&#39;authentification pour verification</span>
    <span class="ruby-ivar">@otp</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Authentication</span><span class="ruby-operator">::</span><span class="ruby-identifier">auth_top</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-string">&#39;context&#39;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@otp</span>[<span class="ruby-value">0</span>]
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Le compte #{@phone} vient de se faire envoyer le SMS de confirmation&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#notified admin for these errors</span>

      <span class="ruby-constant">ApiMailer</span>.<span class="ruby-identifier">create_notifyAdmin</span>

      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@otp</span>[<span class="ruby-value">1</span>], <span class="ruby-string">&quot;Impossible de transmettre le SMS de confirmarion&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> {<span class="ruby-node">&quot;Creation de de l&#39;utiliateur #{@phone} impossible : #{@customer.errors.full_messages}&quot;</span>}
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Echec de creation du profil personnel. code erreurs : #{@customer.errors.full_messages}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-create_user_account" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_user_account</span><span
            class="method-args">(phone)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CREATION DU COMPTE VIRTUEL FINANCIER UTILISATEUR</p>

<pre>@name     Client::create_user_account(id:integer, phone:integer)
@detail   Permet de creer un compte utilisateur sur la plateforme
@params   [object] phone
@return   boolean
@author @mvondoyannick
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="create_user_account-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">create_user_account</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Demarrage de la creation du compte utilisateur ...&quot;</span>
  <span class="ruby-comment">#@id = id</span>
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>

  <span class="ruby-comment">#recherche du customer</span>
  <span class="ruby-comment">#customer = Customer.exists?(phone: @phone)</span>
  <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Utilisateur #{@phone} est inconnu&quot;</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-value">amount:</span> <span class="ruby-value">0.0</span>,
        <span class="ruby-value">customer_id:</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">id</span>
    )

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">save</span>

      <span class="ruby-comment"># Ajout de l&#39;abonnement basique pour ce client</span>
      <span class="ruby-comment">#Rails::logger::info &quot;Ajout de l&#39;abonnement basique pour ce customer #{@customer.id}&quot;</span>
      <span class="ruby-comment">#Abonnements::Abonnements.add(1, @customer.id)</span>

      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Utilisateur #{@customer.phone} crée a #{Time.now}&quot;</span>

      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;creation porte-monnaie effectué avec succes!&quot;</span>

    <span class="ruby-keyword">else</span>

      <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Une erreur est survenue durant le processus de creation compte virtuel! Merci de patienter, un agent PayMeQuick va vous contacter d&#39;ici peu. #{$signature}&quot;</span>)

      <span class="ruby-comment"># envoi du courriel de notification aux administrateurs</span>
      <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sms_to_many</span>({<span class="ruby-value">yan:</span> <span class="ruby-value">691451189</span>, <span class="ruby-value">nana:</span> <span class="ruby-value">698500871</span>, <span class="ruby-value">boss:</span> <span class="ruby-value">697970210</span>}, <span class="ruby-node">&quot;Une erreur est survenue durant le processus de creation de compte : Impossible de creer le compte viertuel pour #{@customer.photo}&quot;</span>)
      <span class="ruby-comment"># fin de notification</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Echec de creation du porte monnaie virtuel #{App::PayMeQuick::App.app[:signature]} pour le compte #{@customer.phone}: #{account.errors.full_messages}&quot;</span>

    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-credit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">credit</span><span
            class="method-args">(phone, amount)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CREDIT DU COMPTE VIRTUEL DU CLIENT</p>

<pre>@param [Object] phone
@param [Object] amount
@author @mvondoyannick
@version 1.0.1
@return [Object]</pre>
          
          

          
          <div class="method-source-code" id="credit-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 240</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">credit</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">amount</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>
  <span class="ruby-ivar">@hash</span> = <span class="ruby-node">&quot;PR_#{SecureRandom.hex(13).upcase}&quot;</span>

  <span class="ruby-comment">#on rechercher le user pour avoir sont ID</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Aucune utilisateur ne correspond.&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@account</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-comment">#puts &quot;Auccun compte correspondant trouve.&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Auccun compte correspondant trouvé appartenant à #{customer.phone}.&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># Refactoring on incrementation</span>
      <span class="ruby-comment">#@account.amount.to_i += @amount.to_i</span>

      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-ivar">@account</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>)

        <span class="ruby-identifier">transaction</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>,
            <span class="ruby-value">code:</span> <span class="ruby-ivar">@hash</span>,
            <span class="ruby-value">flag:</span> <span class="ruby-string">&quot;recharge&quot;</span>.<span class="ruby-identifier">upcase</span>,
            <span class="ruby-value">context:</span> <span class="ruby-string">&quot;none&quot;</span>,
            <span class="ruby-comment"># date: Time.now.strftime(&quot;%d-%m-%Y @ %H:%M:%S&quot;),</span>
            <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>
        )

        <span class="ruby-comment"># on enregistre la transaction</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">transaction</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;#{prettyCallSexe(customer.sexe)} #{customer.complete_name}, votre compte vient d &#39;être credité d&#39;un montant de #{@amount} #{App::PayMeQuick::App::devise}. Le solde de votre compte est actuellement de #{customer.account.amount} #{App::PayMeQuick::App::devise}. ID : #{@hash}. #{App::PayMeQuick::App::app[:signature]}&quot;</span>)
          <span class="ruby-comment">#puts &quot;Le compte a ete credite d\&#39;un montant de #{@amount}&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;Le compte a ete credite d\&#39;un montant de #{@amount}.&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-comment">#puts &quot;impossible de sauvegarder&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Impossible de sauvegarder votre activité&quot;</span>
        <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">else</span>

        <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-node">&quot;#{prettyCallSexe(customer.sexe)} #{customer.complete_name}, impossible de crediter votre compte. Echec de la Transaction #{@hash}. #{App::PayMeQuick::App::app[:signature]}&quot;</span>)

        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Impossible de crediter votre le compte #{App::PayMeQuick::App::app[:signature]}. code erreurs : #{@account.errors.full_messages}&quot;</span>

      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-debit_client" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">debit_client</span><span
            class="method-args">(id, amount, signature)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>DEBITER LE COMPTE D UN CLIENT</p>

<pre>@param [Object] id
@param [Object] amount
@param [Object] signature
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="debit_client-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 800</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">debit_client</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">amount</span>, <span class="ruby-identifier">signature</span>)
  <span class="ruby-ivar">@id</span> = <span class="ruby-identifier">id</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>
  <span class="ruby-ivar">@signature</span> = <span class="ruby-identifier">signature</span>

  <span class="ruby-identifier">response</span> = <span class="ruby-identifier">find_client</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>[<span class="ruby-value">0</span>]
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#on recherche le compte de ce client</span>
    <span class="ruby-identifier">account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find_by_customer_id</span>(<span class="ruby-identifier">response</span>[<span class="ruby-value">1</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Impossible de trouver le compte client&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-debit_user_account" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">debit_user_account</span><span
            class="method-args">(phone, amount)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>DEBIT LE COMPTE UTILISATEUR DURANT LA PROCEDURE DE RETRAIT</p>

<pre>@param [Object] phone
@param [Object] amount
@author @mvondoyannick
@version 1.0.0</pre>
          
          

          
          <div class="method-source-code" id="debit_user_account-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 823</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">debit_user_account</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">amount</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>

  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">account</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-comment"># on recherche s&#39;il ya des intention de retrait en cours non encore perimé</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Aucune intention de transaction en cours ... on peut demarrer la procedure&quot;</span>
        <span class="ruby-identifier">a</span> = <span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Information compte client #{@phone} à #{Time.now} est de #{account.amount} FC.&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-identifier">a</span>) <span class="ruby-comment">#account.update(customer_id: customer.id, amount: account.amount)</span>
          <span class="ruby-identifier">transaction</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>,
            <span class="ruby-value">code:</span> <span class="ruby-ivar">@hash</span>,
            <span class="ruby-value">flag:</span> <span class="ruby-string">&quot;recharge&quot;</span>.<span class="ruby-identifier">upcase</span>,
            <span class="ruby-value">context:</span> <span class="ruby-string">&quot;none&quot;</span>,
            <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>
          )

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">transaction</span>.<span class="ruby-identifier">save</span>

            <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Compte debité avec succes&quot;</span>

            <span class="ruby-comment">#Creditation de l&#39;await</span>
            <span class="ruby-identifier">new_await</span> = <span class="ruby-constant">Await</span>.<span class="ruby-identifier">new</span>(
              <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>,
              <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>,
              <span class="ruby-value">end:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">minute</span>.<span class="ruby-identifier">from_now</span>,
              <span class="ruby-value">used:</span> <span class="ruby-keyword">false</span>,
              <span class="ruby-value">hashawait:</span> <span class="ruby-node">&quot;PR_RETRAIT_#{SecureRandom.hex(13).upcase}&quot;</span>,
              <span class="ruby-value">agent:</span> <span class="ruby-string">&quot;dev_console&quot;</span>
            )

            <span class="ruby-comment">#save await</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_await</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-node">&quot;Vous allez effectuer un retrait de #{@amount} FC, merci de valider dans votre application PMQ-&gt;retirer.&quot;</span>)
              <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Compte #{customer.phone} debité avec succes du montant #{@amount}&quot;</span>
            <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">else</span>

            <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Impossible de mettre a jour les informations client&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Des erreurs sont survenues durant le traitement de certaines informations : #{transaction.errors.full_messages}&quot;</span>

          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment"># une intention de retrait existe deja, annulation de la procedure en cours</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;impossible d&#39;effectuer un retrait sur ce compte, un autre retrait existe en ce moment&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># le compte du client n&#39;existe pas</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Il semble avoir un problème avec le compte de cet utilisateur. Demande annulée!&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#Utilisateur inconnu</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu de nos services&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-device" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">device</span><span
            class="method-args">(argc, locale)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CHECK CUSTOMER DEVICE ID</p>

<pre>detail verify if customer Device has been change on new login
param [Object] argc
TODO update customer locale for translation</pre>
          
          

          
          <div class="method-source-code" id="device-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 295</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">device</span>(<span class="ruby-identifier">argc</span>, <span class="ruby-identifier">locale</span>)
  <span class="ruby-ivar">@device</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:device</span>] <span class="ruby-comment"># devise here mean the smartphone uuid</span>
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-ivar">@locale</span> = <span class="ruby-identifier">locale</span>

  <span class="ruby-comment"># verify customer device</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;customerNotFound&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">device</span>.<span class="ruby-identifier">nil?</span>

      <span class="ruby-comment">#first time customer login on the plateform</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Mise à jour de l&#39;uuid du customer avec la valeur #{@device}&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">customer_datum</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">uuid:</span> <span class="ruby-ivar">@device</span>)

        <span class="ruby-comment"># mise a jour de la valeur de trouvant dans customer.device</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">device:</span> <span class="ruby-ivar">@device</span>)

          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Mise à jour des données de l&#39;utilisateur reussi&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-comment">#, &quot;Welcome to first login on PayCore #{customer.name}&quot;</span>

        <span class="ruby-keyword">else</span>

          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Fail to update main device&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Impossible de valide ce terminal&quot;</span>

        <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">else</span>

        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Impossible de mettre votre device UUID a jour&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-comment">#, &quot;send SMS for confirmation authentication on the new device&quot;</span>

      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">device</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@device</span>

        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;UUID est indentique, authentication continu&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>

      <span class="ruby-keyword">else</span>
        <span class="ruby-comment"># Update new device to customerDatum.uuid2</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">customer_datum</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">uuid2:</span> <span class="ruby-ivar">@device</span>)

          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Mise a jour de l&#39;UUID 2 effectuée avec la value #{@device} pour le nouveau terminal&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-comment">#Updated</span>

        <span class="ruby-keyword">else</span>

          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Impossible de mettre a jour l&#39;UUID 2&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-comment">#Unable to updated</span>

        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-find_client" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_client</span><span
            class="method-args">(customer_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RECHERCHE D&#39;UN CLIENT SUR LA PLATEFORME</p>

<pre>@param [Object] customer_id
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50
@return [Object] customer
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="find_client-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 768</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">find_client</span>(<span class="ruby-identifier">customer_id</span>)
  <span class="ruby-ivar">@customer</span> = <span class="ruby-identifier">customer_id</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@customer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">customer</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-find_marchand" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_marchand</span><span
            class="method-args">(id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RECHERCHE LE RECEVEUR OU LE MARCHAND @param [Integer] id @author
@mvondoyannick @version 1.0.0</p>
          
          

          
          <div class="method-source-code" id="find_marchand-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 782</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">find_marchand</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-ivar">@receiver_id</span> = <span class="ruby-identifier">id</span>
  <span class="ruby-identifier">query</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-string">&quot;Impossible de terminer cette requete, utilisateur inconnu&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisateur identifié&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">query</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_balance" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_balance</span><span
            class="method-args">(argv, message=nil , locale)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>OBTENIR LE SOLDE DU COMPTE</p>

<pre>@name
@detail
@param [Object] tel
@param [Object] password
@return [Object]
@author @mvondoyannick
@version 1.0.1.1</pre>
          
          

          
          <div class="method-source-code" id="get_balance-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 625</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_balance</span>(<span class="ruby-identifier">argv</span>, <span class="ruby-identifier">message</span>=<span class="ruby-keyword">nil</span> , <span class="ruby-identifier">locale</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">message</span>
  <span class="ruby-identifier">locale</span> = <span class="ruby-identifier">locale</span>

  <span class="ruby-comment">#on recherche le client</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-string">&quot;Authenticating user failed, unknow user. end request!&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;customerNotFound&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-identifier">locale</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@password</span>)
      <span class="ruby-comment"># account = Account.find_by_customer_id(query.id)</span>
      <span class="ruby-comment"># starting refactoring account</span>
      <span class="ruby-identifier">account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Aucun compte utilisateur correcpondant ou compte vide&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#return OneSignal API</span>
        <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-node">&quot;#{prettyCallSexe(customer.sexe)} #{customer.complete_name}, le solde de votre compte est : #{account} #{$devise}. #{App::PayMeQuick::App::app[:signature]}&quot;</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;#{prettyCallSexe(customer.sexe)} #{customer.complete_name}, le solde de votre compte est : #{account} #{$devise}. #{$signature}&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>

      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;passwordInvalid&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-identifier">locale</span>)

    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_balance_retrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_balance_retrait</span><span
            class="method-args">(phone, amount_retrait)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>VERIFIER SI LE CLIENT DISPOSE DU SOLDE SUFFISA?T DANS SON COMPTE POUR
EFFECTUER LA TRANSACTION</p>

<pre>@method name  Get Balance before retrait
@name         Client::get_balance_retrait
@params       phone amount
@output       boolean [true/false]
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="get_balance_retrait-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1237</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">get_balance_retrait</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">amount_retrait</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount_retrait</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Starting get balance for account #{@phone}, amount of #{@amount}&quot;</span>
  <span class="ruby-comment">#on ne peut pas retirer moins de 500 FC XAF</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@amount</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">500</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;Tentative de retrait d&#39;un montant inferieur a 500F, Transaction annulée&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-string">&quot;Utilisation inconnu, Transaction annulée.&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">customer_amount</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-comment">#Account.where(customer_id: customer.id).first.amount</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer_amount</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Montant superieur/egale dans le compte #{@phone}. Transaction possible.&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-node">&quot;Le montant de votre compte est insuffisant. #{$signature}&quot;</span>)
        <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Montant inferieur dans le compte #{@phone}. Impossible de poursuivre la transaction.&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-hashAmount" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hashAmount</span><span
            class="method-args">(amount)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Permet de hacher le montant</p>
          
          

          
          <div class="method-source-code" id="hashAmount-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1640</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">hashAmount</span>(<span class="ruby-identifier">amount</span>)
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_i</span>

  <span class="ruby-identifier">amountHashed</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-ivar">@amount</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">amountHashed</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-init_retrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">init_retrait</span><span
            class="method-args">(phone, amount, agent)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>INITIALISATION DE LA PROCEDURE DE RETRAIT</p>

<pre>@method name  Get Balance before retrait
@name         Client::init_retrait
@params       [object] phone
@param        [object] amount
@return       boolean [true/false]
@author @mvondoyannick
@version 1.0.0
@OneSignal Adding oneSignal</pre>
          
          

          
          <div class="method-source-code" id="init_retrait-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1275</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">init_retrait</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">amount</span>, <span class="ruby-identifier">agent</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-ivar">@agent</span> = <span class="ruby-identifier">agent</span> <span class="ruby-comment"># Agent initialisateur de la procedure de retrait</span>
  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Demarrage initialisation retrait pour #{@phone} ...&quot;</span>
  <span class="ruby-comment">#se trouve dans la table retrait_await, on ajout un marqueur au client</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">get_balance_retrait</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-ivar">@amount</span>) <span class="ruby-comment">#il a suffisament d&#39;argent</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-comment">#on creet un nouvel await</span>
        <span class="ruby-identifier">await</span> = <span class="ruby-constant">Await</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>,
            <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>,
            <span class="ruby-value">agent:</span> <span class="ruby-ivar">@agent</span>
        )
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">await</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-comment">#mise a jour du montant du customer</span>
          <span class="ruby-identifier">account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span> <span class="ruby-comment">#Account.where(customer_id: customer.id).first</span>
          <span class="ruby-identifier">customer_amount</span> = <span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>

          <span class="ruby-comment">#on mets a jour la table customer sur await</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-identifier">customer_amount</span>)
            <span class="ruby-comment">#---------------send sms to customer--------------</span>
            <span class="ruby-comment">#OneSignal::OneSignalSend.retraitOneSignal()</span>
            <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-node">&quot;Vous allez effectuer un retrait d un montant de #{@amount} #{$devise}. Bien vouloir cliquer sur &lt;&lt;RETIRER&gt;&gt; sur dans l&#39;application #{$signature}&quot;</span>)
            <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
            <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Processus initialisé avec succes pour le numéro #{@phone}. Delais de #{5.minutes.from_now}&quot;</span>
            <span class="ruby-comment">#puts &quot;user await updated&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Processus initialisé avec succes pour le numero #{@phone}&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#puts &quot;user await canceled&quot;</span>
            <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Processus de retrait du montant #{@phone}, d&#39;un montant de #{@amount} a ete annulé.&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Impossible d\&#39;initialiser le processus de retrait. Error : #{customer.errors.messages}&#39;&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Impossible d&#39;initialiser le retrait vers #{@phone} on #{Time.now}.&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Impossible d&#39;initialiser le retrait. Procedure annulée.&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#le client n&#39;est pas disponible sur la plateforme</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Impossible d&#39;initialiser le retrait vers #{@phone}, Client inexistant.&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Impossible d&#39;initialiser le retrait, Utilisateur inconnu ou disposant deja &quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Impossible d&#39;initialiser le retrait vers #{@phone} on #{Time.now}. Montant dans le compte client est insuffisant&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Processus de annulé, Ce compte ne dispose pas assez d argent&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-isFraud-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">isFraud?</span><span
            class="method-args">(phone, sim_phone, network_operator, uuid, imei)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>VERIFICATION DE LA FRAUDE SUR LA PLATEFORME</p>

<pre>@name     isFraud
@detail   Permt de determiner d&#39;eventuel systeme de fraude
@param [Object] phone
@param [Object] sim_phone
@param [Object] network_operator
@param [Object] uuid
@param [Object] imei
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="isFraud-3F-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 483</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">isFraud?</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">sim_phone</span>, <span class="ruby-identifier">network_operator</span>, <span class="ruby-identifier">uuid</span>, <span class="ruby-identifier">imei</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@sim_phone</span> = <span class="ruby-identifier">sim_phone</span>
  <span class="ruby-ivar">@network_operator</span> = <span class="ruby-identifier">network_operator</span>
  <span class="ruby-ivar">@uuid</span> = <span class="ruby-identifier">uuid</span>
  <span class="ruby-ivar">@imei</span> = <span class="ruby-identifier">imei</span>
  <span class="ruby-comment">#test if phone and sim_phone are same</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@phone</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-ivar">@sim_phone</span>)
    <span class="ruby-comment">#on recherche les information dans la base de données customerData</span>
    <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-identifier">phone</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisateur Impossible à identifier&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#recherche dans la table customerData</span>
      <span class="ruby-identifier">antiFraud</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">customer_datum</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">antiFraud</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisation frauduleuse detectée&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Faude detectée&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#comparaison des differentes informations recues</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@phone</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-identifier">antiFraud</span>[<span class="ruby-value">:phone</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@sim_phone</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-identifier">antiFraud</span>[<span class="ruby-value">:sim_phone</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@network_operator</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-identifier">antiFraud</span>[<span class="ruby-value">:network_operator</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@uuid</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-identifier">antiFraud</span>[<span class="ruby-value">:uuid</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@imei</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-identifier">antiFraud</span>[<span class="ruby-value">:imei</span>])
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisateur et terminal compatible.&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;Client et mobile authenticated&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;des informations divergentes ont été trouvées.&quot;</span>

          <span class="ruby-comment"># Bloquer le compte du client</span>

          <span class="ruby-identifier">result</span> = <span class="ruby-identifier">lockCustomerAccount</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-string">&quot;Informations divergentestrouvées&quot;</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>[<span class="ruby-value">0</span>]
            <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;#{result[1]}&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">result</span>[<span class="ruby-value">1</span>]
          <span class="ruby-keyword">else</span>
            <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;#{result[1]}&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">result</span>[<span class="ruby-value">1</span>]
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Numero carte SIM et numero de compte ne sont pas identiques.&quot;</span>
    <span class="ruby-comment">#envoi du SMS sur sim_phone</span>
    <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sim_phone</span>, <span class="ruby-string">&quot;La plateforme ne reconnais pas votre carte SIM!&quot;</span>)
    <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
    <span class="ruby-comment"># fin d&#39;envoi</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Les numéro de votre carte SIM et celui de ce compte #{App::PayMeQuick::App::app[:signature]} sont differents.&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-isLock-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">isLock?</span><span
            class="method-args">(token)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>VERIFICATION DU STATUT D&#39;UN COMPTE Bloquer|voler|desactiver|autre</p>

<pre>@name
@detail   permet de verifier si un compte est actuellement bloquer ou non
params    token:string
@param [Object] token
@author @mvondoyannick
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="isLock-3F-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 727</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">isLock?</span>(<span class="ruby-identifier">token</span>)
  <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">token</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">two_fa</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;authenticate&quot;</span>

      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Utilisateur #{customer.phone} authentifié sur #{App::PayMeQuick::App::app[:signature]}&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;authenticate&quot;</span>, <span class="ruby-string">&quot;Compte non bloqué&quot;</span>, <span class="ruby-string">&quot;Aucun motif&quot;</span>

    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;lock&quot;</span>

      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Utilisateur #{customer.phone} bloqué&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;locked&quot;</span>, <span class="ruby-node">&quot;Compte #{customer.phone} bloqué.&quot;</span>, <span class="ruby-string">&quot;Aucun motifs&quot;</span>

    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;delete&quot;</span>

      <span class="ruby-comment"># end notification</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Utilisateur #{customer.phone} supprimé sur #{App::PayMeQuick::App::app[:signature]}&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;deleted&quot;</span>, <span class="ruby-string">&quot;Ce compte a ete supprimer&quot;</span>

    <span class="ruby-keyword">else</span>

      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Utilisateur #{customer.phone} rencontre des erreurs, valeurs incoherentes trouvées&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Des erreurs ont ete identifiées sur ce compte, merci de vous rapprocher d&#39;une agence partenaire #{App::PayMeQuick::App::app[:signature]}&quot;</span>

    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-is_await_valid-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_await_valid?</span><span
            class="method-args">(phone)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>VERIFICATION INTENT DE RETRAIT EST PERIME – OU PAS</p>

<pre>@method     name Verifier sur une procedure de retrait est encore valide
@name       Client::is_await_valide
@params     phone
@output     boolean [true/false]
@author @mvondoyannick
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="is_await_valid-3F-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1085</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">is_await_valid?</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Starting await verification ...&quot;</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Utilisateur #{@phone} est inconnu du systeme&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">await</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span> <span class="ruby-comment">#Await.where(customer_id: customer.id).last</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">await</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Aucun retrait en attente pour l&#39;Utilisateur #{@phone}&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Aucun retrait en attente pour l&#39;Utilisateur #{@phone}&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#on comparate les dates</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">await</span>.<span class="ruby-identifier">end</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">await</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Transacttion #{await.hashawait} est en cours et valide.&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Transaction #{await.hashawait} valide&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Transaction #{await.hashawait} n&#39;est plus valide. supression...&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">await</span>.<span class="ruby-identifier">destroy</span>
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Transaction #{await.hashawait} qualifiée de perimée a été supprimée.&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Transaction #{await.hashawait} qualifiée de perimée a été supprimée.&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">fatal</span> <span class="ruby-node">&quot;Transaction #{await.hashawait} qualifiée de perimée n&#39;a pas pu etre supprimer. Impossible de supprimer la transaction. Contact du service de maintenance.&quot;</span>
          <span class="ruby-identifier">contact</span> = <span class="ruby-constant">ContactForm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">name:</span> <span class="ruby-string">&quot;MVONDO&quot;</span>, <span class="ruby-value">email:</span> <span class="ruby-string">&quot;yaf.mvondo@agis-as.com&quot;</span>, <span class="ruby-value">message:</span> <span class="ruby-node">&quot;FATAL : Transaction #{await.hashawait} qualifiée de perimée n&#39;a pas pu etre supprimer. Intervention urgente.&quot;</span>)
          <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">deliver</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Transaction #{await.hashawait} ne peut etre supprimer, demarrage de l&#39;envoi du courriel au service de maintenance ...&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-lockCustomerAccount" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">lockCustomerAccount</span><span
            class="method-args">(phone, motif)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>BLOCAGE D&#39;UN COMPTE UTILISATEUR SUR LA PLATEFORME</p>

<pre>@description
@name
@detail
@param [Object] phone
@param [Object] motif
@return [Object]
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="lockCustomerAccount-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 543</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">lockCustomerAccount</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">motif</span>)
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@motif</span> = <span class="ruby-identifier">motif</span>

  <span class="ruby-comment"># recherche effective du customer</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#on verifie effectivement si le compte est bloqué</span>
    <span class="ruby-identifier">verrou</span> = <span class="ruby-identifier">isLock?</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">authentication_token</span>) <span class="ruby-comment">#le verrou de securité</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">verrou</span>[<span class="ruby-value">0</span>]
      <span class="ruby-comment">#il est effectivement bloqué, on le debloque</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">two_fa:</span> <span class="ruby-string">&quot;authenticate&quot;</span>)
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Utilisateur #{customer.phone} vient d&#39;etre debloqué&quot;</span>

        <span class="ruby-comment">#envoi du SMS</span>
        <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Votre compte #{customer.phone} vient d&#39;etre débloqué, merci de vous reconnecter.&quot;</span>)

        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Compte #{customer.phone} debloqué avec succes!&quot;</span>

      <span class="ruby-keyword">else</span>

        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Ce compte #{customer.phone} est actuellement bloqué.&quot;</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Impossible de debloquer  le compte #{customer.phone}&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">verrou</span>[<span class="ruby-value">1</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(from, to, amount, pwd)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@param [Object] from @param [Object] to @param [Object] amount @param
[Object] pwd @return [Object] nil @author @mvondoyannick @version
0.0.1beta-rev-11-03-83-50</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">amount</span>, <span class="ruby-identifier">pwd</span>)
  <span class="ruby-identifier">$from</span> = <span class="ruby-identifier">from</span>
  <span class="ruby-identifier">$to</span> = <span class="ruby-identifier">to</span>
  <span class="ruby-identifier">$amount</span> = <span class="ruby-identifier">amount</span>
  <span class="ruby-identifier">$pwd</span> = <span class="ruby-identifier">pwd</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-pay" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pay</span><span
            class="method-args">(argv, message=nil, locale=&quot;fr&quot;)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>PERMET D EFFECTUER UN PAIEMENT D&#39;UN CLIENT A UN AUTRE CLIENT</p>

<pre>@method name  Pay
@name         Client::pay
@params       [object] emeteur
@param        [object] destinataire
@params       [object] montant
@params       [object] password
@output       [boolean] [true/false]
@author @mvondoyannick
@version 1.0.2</pre>
          
          

          
          <div class="method-source-code" id="pay-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1339</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">pay</span>(<span class="ruby-identifier">argv</span>, <span class="ruby-identifier">message</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">locale</span>=<span class="ruby-string">&quot;fr&quot;</span>)
  <span class="ruby-identifier">customer</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:customer</span>]
  <span class="ruby-ivar">@to</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:merchant</span>]
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:amount</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-comment">#montant de la transation</span>
  <span class="ruby-ivar">@client_password</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-ivar">@ip</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:ip</span>]
  <span class="ruby-ivar">@lat</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:lat</span>]
  <span class="ruby-ivar">@lon</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:lon</span>]

  <span class="ruby-ivar">@locale</span> = <span class="ruby-identifier">locale</span>

  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Demarrage du paiement d&#39;une transaction : #{message}&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@to</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Numéro indentique, transaction annuler!&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, {
        <span class="ruby-value">title:</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;errMerchantTitle&quot;</span>,<span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>),
        <span class="ruby-value">message:</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;errMerchantContent&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>)
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Traitement des informations sur le marchand</span>
    <span class="ruby-keyword">begin</span>

      <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;recherche des informations sur le marchand ...&quot;</span>
      <span class="ruby-identifier">marchand</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@to</span>)
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Getting customer informations account&quot;</span>
      <span class="ruby-identifier">marchand_account</span> = <span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">account</span> <span class="ruby-comment">#le montant de la personne qui recoit</span>
      
    <span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">exception</span>

      <span class="ruby-comment">#sending email to admin</span>
      <span class="ruby-constant">OneSignal</span><span class="ruby-operator">::</span><span class="ruby-constant">SendEmailAPI</span>.<span class="ruby-identifier">sendEmail</span>(<span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-constant">PayMeQuick</span><span class="ruby-operator">::</span><span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-identifier">developer</span>[<span class="ruby-value">:email</span>], <span class="ruby-identifier">argv</span>, <span class="ruby-identifier">exception</span>, <span class="ruby-identifier">locale</span>)
      
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Une erreur est survenue : #{exception}&quot;</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Compte marchand #{@to} voulant recevoir un paiement est inconnu&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, {
        <span class="ruby-value">title:</span> <span class="ruby-string">&quot;Echec Transaction&quot;</span>,
        <span class="ruby-value">content:</span> <span class="ruby-string">&quot;Le marchand vers qui la transaction doit se faire est inconnu&quot;</span>
      }
      
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Traitement des informations sur le client</span>
    <span class="ruby-keyword">begin</span>

      <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Getting customer informations ...&quot;</span>
      <span class="ruby-identifier">client</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-identifier">customer</span>) <span class="ruby-comment">#la personne qui envoi</span>

      <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Getting custommer account informations ...&quot;</span>
      <span class="ruby-identifier">client_account</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">account</span> <span class="ruby-comment"># le montant de la personne qui envoi</span>
      
    <span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">exception</span>

      <span class="ruby-comment">#sending email to admin</span>
      <span class="ruby-constant">OneSignal</span><span class="ruby-operator">::</span><span class="ruby-constant">SendEmailAPI</span>.<span class="ruby-identifier">sendEmail</span>(<span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-constant">PayMeQuick</span><span class="ruby-operator">::</span><span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-identifier">developer</span>[<span class="ruby-value">:email</span>], <span class="ruby-identifier">argv</span>, <span class="ruby-identifier">exception</span>, <span class="ruby-identifier">locale</span>)
      
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Une erreur est survenue : #{exception}&quot;</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Compte client #{customer} voulant effectuer un paiement est inconnu : Données complementaires =&gt;&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, {
        <span class="ruby-value">title:</span> <span class="ruby-string">&quot;Echec transaction&quot;</span>,
        <span class="ruby-value">content:</span> <span class="ruby-string">&quot;Ce compte est inconnu. Transaction annulée&quot;</span>
      }
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@client_password</span>)
      <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Client identifié avec succes!&quot;</span>
      <span class="ruby-comment">#puts &quot;Customer #{client.complete_name} identifié avec succes!&quot;</span>

      <span class="ruby-comment">#contrainte si le montant depasse 150 000 FC XAF</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-constant">PayMeQuick</span><span class="ruby-operator">::</span><span class="ruby-constant">App</span>.<span class="ruby-identifier">limit</span>[<span class="ruby-value">:limit_amount</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-comment">#$limit_amount</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Limite de transaction de 150 000 F dépassée&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, {
            <span class="ruby-value">title:</span> <span class="ruby-string">&quot;LIMITE DE TRANSACTION&quot;</span>,
            <span class="ruby-value">message:</span> <span class="ruby-node">&quot;#{prettyCallSexe(client.sexe)} #{client.complete_name} il semblerait que votre transaction dépasse la limité autorisée de #{$limit_amount} #{$devise}. Merci de revoir le montant de votre transaction.&quot;</span>
        }
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">client_account</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>)
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Le compte du client dispose du montant suffisant pour effectuer la transaction ...&quot;</span>
          <span class="ruby-ivar">@hash</span> = <span class="ruby-node">&quot;PP_#{SecureRandom.hex(13).upcase}&quot;</span>

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">client_account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">soldeTest</span>(<span class="ruby-identifier">client_account</span>.<span class="ruby-identifier">amount</span>, <span class="ruby-ivar">@amount</span>))
            
            <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Solde dans le compte du client #{client.phone} : #{client_account.amount.to_f} FC&quot;</span>
            <span class="ruby-identifier">marchand_account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>

            <span class="ruby-comment">#on historise la transaction du marche</span>
            <span class="ruby-comment">#saveHistory(@to, @hash,&quot;ENCAISSEMENT&quot;,&quot;none&quot;,@amount,nil ,nil ,nil )</span>
            <span class="ruby-identifier">marchant_log</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
              <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">id</span>,
              <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>,
              <span class="ruby-value">code:</span> <span class="ruby-ivar">@hash</span>,
              <span class="ruby-value">flag:</span> <span class="ruby-string">&quot;encaissement&quot;</span>.<span class="ruby-identifier">upcase</span>,
              <span class="ruby-value">context:</span> <span class="ruby-string">&quot;Mobile&quot;</span>.<span class="ruby-identifier">upcase</span>,
              <span class="ruby-value">ip:</span> <span class="ruby-ivar">@ip</span>
            )

            <span class="ruby-comment">#on enregistre</span>
            <span class="ruby-identifier">marchant_log</span>.<span class="ruby-identifier">save</span>

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">marchand_account</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-comment">#envoi d&#39;une notification OneSignal</span>
              <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Paiement recu. Montant :  #{@amount} FC, \t Payeur : #{prettyCallSexe(client.sexe)} #{client.complete_name}. Votre nouveau solde:  #{marchand_account.amount} FC. ID : #{@hash}. #{App::PayMeQuick::App::app[:signature]}&quot;</span>)

              <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Paiement effectué de #{@amount} FC entre #{customer} et #{@to}.&quot;</span>

              <span class="ruby-comment">#on enregistre encore l&#39;historique</span>
              <span class="ruby-identifier">client_log</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
                <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">id</span>,
                <span class="ruby-value">amount:</span> <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>),
                <span class="ruby-value">context:</span> <span class="ruby-string">&quot;Mobile&quot;</span>.<span class="ruby-identifier">upcase</span>,
                <span class="ruby-value">ip:</span> <span class="ruby-ivar">@ip</span>,
                <span class="ruby-value">flag:</span> <span class="ruby-string">&#39;paiement&#39;</span>.<span class="ruby-identifier">upcase</span>,
                <span class="ruby-value">code:</span> <span class="ruby-ivar">@hash</span>
              )

              <span class="ruby-keyword">if</span> <span class="ruby-identifier">client_log</span>.<span class="ruby-identifier">save</span>

                <span class="ruby-comment">#fin de journalisation</span>
                <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Historique de transaction enregistrée avec succes&quot;</span>

                <span class="ruby-comment">#enregistrement des commissions</span>
                <span class="ruby-identifier">commission</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">commission</span>(<span class="ruby-ivar">@hash</span>, <span class="ruby-ivar">@amount</span>, <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>).<span class="ruby-identifier">to_f</span>, (<span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>).<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>))
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">commission</span>
                  <span class="ruby-comment">#fin d&#39;enregistrement de la commission</span>
                  <span class="ruby-identifier">a</span> = {
                      <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>,
                      <span class="ruby-value">device:</span> <span class="ruby-string">&#39;XAF&#39;</span>,
                      <span class="ruby-value">frais:</span> (<span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>).<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>),
                      <span class="ruby-value">total:</span> <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>).<span class="ruby-identifier">to_f</span>,
                      <span class="ruby-value">receiver:</span> <span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">complete_name</span>,
                      <span class="ruby-value">sender:</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">complete_name</span>,
                      <span class="ruby-value">date:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d-%m-%Y, %Hh:%M&quot;</span>),
                      <span class="ruby-value">status:</span> <span class="ruby-string">&quot;DONE&quot;</span>
                  }
                  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Transaction response =&gt; #{a}&quot;</span>

                  <span class="ruby-identifier">resume</span> = <span class="ruby-node">&quot;#{prettyCallSexe(client.sexe)} #{client.complete_name} votre Paiement a été effectué. \n Montant de la transaction : #{@amount} FC, \n Frais de la transaction : #{Parametre::Parametre::agis_percentage(@amount).to_f - @amount.to_f} FC \n Total prelevé dans votre compte : #{Parametre::Parametre::agis_percentage(@amount).to_f} FC, \n Marchant ayant recu le paiement : #{marchand.complete_name}, \n Date de la transaction : #{Time.now.strftime(&quot;%d-%m-%Y, %Hh:%M&quot;)} \n Statut de la transaction: EFFECTUÉE ET TERMINÉE SANS ERREURS \n Lien transaction : https://payquick-develop.herokuapp.com/webview/#{@hash}/#{client.id}&quot;</span>

                  <span class="ruby-comment">#send email to customer</span>
                  <span class="ruby-constant">OneSignal</span><span class="ruby-operator">::</span><span class="ruby-constant">SendEmailAPI</span>.<span class="ruby-identifier">sendEmail</span>(<span class="ruby-identifier">client</span>.<span class="ruby-identifier">email</span>, <span class="ruby-identifier">resume</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">locale</span>)

                  <span class="ruby-comment">#send email to merchant</span>
                  <span class="ruby-constant">OneSignal</span><span class="ruby-operator">::</span><span class="ruby-constant">SendEmailAPI</span>.<span class="ruby-identifier">sendEmail</span>(<span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">email</span>, <span class="ruby-node">&quot;Paiement recu. Montant :  #{@amount} FC \n Client ayant effectuer le Paiement : #{prettyCallSexe(client.sexe)} #{client.complete_name}. \n Votre nouveau solde:  #{marchand_account.amount} FC . \n Transaction ID : #{@hash}. \n Date : #{Time.now}. \n Lien de transaction : https://payquick-develop.herokuapp.com/webview/#{@hash}/#{marchand.id} \n #{App::PayMeQuick::App::app[:signature]}&quot;</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">locale</span>)

                  <span class="ruby-comment"># send SMS</span>
                  <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Paiement recu! montant : #{@amount} FC, paiement recu de #{client.complete_name}. Plus sur https://payquick-develop.herokuapp.com/webview/#{@hash}/#{marchand.id}&quot;</span>)

                  <span class="ruby-comment">#return true, &quot;Votre Paiement de #{@amount} FC vient de s&#39;effectuer avec succes. \t Frais de commission : #{(Parametre::Parametre::agis_percentage(@amount).to_f - @amount).round(2)} F FC. \t Total prelevé de votre compte : #{Parametre::Parametre::agis_percentage(@amount).to_f.round(2)} F FC. \t Nouveau solde : #{client_account.amount.round(2)} #{$devise}.&quot;</span>
                  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, {
                      <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>,
                      <span class="ruby-value">device:</span> <span class="ruby-string">&quot;&quot;</span>,
                      <span class="ruby-value">frais:</span> (<span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>).<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>),
                      <span class="ruby-value">total:</span> (<span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>).<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>),
                      <span class="ruby-value">receiver:</span> <span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">complete_name</span>,
                      <span class="ruby-value">sender:</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">complete_name</span>,
                      <span class="ruby-value">date:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d-%m-%Y, %Hh:%M&quot;</span>),
                      <span class="ruby-value">status:</span> <span class="ruby-string">&quot;DONE&quot;</span>
                  }
                <span class="ruby-keyword">else</span>
                  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Impossible d&#39;entregistrer les commissions de cette transaction&quot;</span>
                <span class="ruby-keyword">end</span>

              <span class="ruby-keyword">else</span>

                <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Impossible d&#39;enregistrer les informations de transation du paiement #{@hash}&quot;</span>

              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-comment"># raise ActiveRecord::Rollback</span>
              <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Impossible de crediter le marchand #{marchand.authentication_token} d&#39;un montant de #{@amount} FC&quot;</span>
              <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Impossible de créditer votre compte de #{amount}. Transaction annulée. #{$signature}&quot;</span>)
              <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Impossible de mettre à jour les informations du client sur la transaction N° #{@hash}, d&#39;un montant de #{@amount} FC&quot;</span>
            <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">client</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Impossible d\n&#39;acceder à votre compte. Transaction annulee. #{$signature}&quot;</span>)
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Le solde du compte client #{client.phone} est insuffisant pour effectuer la transaction de paiement d&#39;un montant de #{@amount}. Paiment impossible&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, {
              <span class="ruby-value">title:</span> <span class="ruby-string">&quot;SOLDE INSUFFISANT&quot;</span>,
              <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Le solde de votre compte est insuffisant pour effectuer cette transaction! Merci de recharger votre compte!&quot;</span>
          }
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#Rails::logger::info &quot;Invalid user password authentication&quot;</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Invalid user password authentication&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, {
          <span class="ruby-value">title:</span> <span class="ruby-string">&quot;ECHEC IDENTIFICATION&quot;</span>,
          <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Le mot de passe utilisé est invalide, merci de réessayer!&quot;</span>
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-prettyCallSexe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prettyCallSexe</span><span
            class="method-args">(sexe)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RETOURNE UNE APPELLATION CONVIVIALE DE L&#39;UTILISATEUR</p>

<pre>@param [String] sexe
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="prettyCallSexe-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 660</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">prettyCallSexe</span>(<span class="ruby-identifier">sexe</span>)
  <span class="ruby-ivar">@sexe</span> = <span class="ruby-identifier">sexe</span>.<span class="ruby-identifier">downcase</span>
  <span class="ruby-keyword">case</span> <span class="ruby-ivar">@sexe</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;masculin&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;M.&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;feminin&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Mme/Mlle&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;M./Mlle/Mme&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-saveHistory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">saveHistory</span><span
            class="method-args">(customer, code, flag, context, amount, ip, lat, lon)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Permet d&#39;enregistrer une transaction de toutes les activités</p>

<pre>@param [Object] customer
@param [Object] code
@param [Object] flag
@param [Object] context
@param [Object] amount
@param [Object] ip
@param [Object] lat
@param [Object] lon</pre>
          
          

          
          <div class="method-source-code" id="saveHistory-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1609</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">saveHistory</span>(<span class="ruby-identifier">customer</span>, <span class="ruby-identifier">code</span>, <span class="ruby-identifier">flag</span>, <span class="ruby-identifier">context</span>, <span class="ruby-identifier">amount</span>, <span class="ruby-identifier">ip</span>, <span class="ruby-identifier">lat</span>, <span class="ruby-identifier">lon</span>)
  <span class="ruby-ivar">@customer</span> = <span class="ruby-identifier">customer</span>
  <span class="ruby-ivar">@code</span> = <span class="ruby-identifier">code</span>
  <span class="ruby-ivar">@flag</span> = <span class="ruby-identifier">flag</span>
  <span class="ruby-ivar">@context</span> = <span class="ruby-identifier">context</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>
  <span class="ruby-ivar">@ip</span> = <span class="ruby-identifier">ip</span>
  <span class="ruby-ivar">@lat</span> = <span class="ruby-identifier">lat</span>
  <span class="ruby-ivar">@lon</span> = <span class="ruby-identifier">lon</span>

  <span class="ruby-comment">#on determine la region sur la base de la geolocalisation</span>
  <span class="ruby-comment">#@region = DistanceMatrix::DistanceMatrix::geocoder_search(@lat, @lon)</span>

  <span class="ruby-comment">#on initialise le journal de la transaction</span>
  <span class="ruby-identifier">h</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
      <span class="ruby-comment"># date: Time.now.strftime(&quot;%d-%m-%Y @ %H:%M:%S&quot;),</span>
      <span class="ruby-value">amount:</span> <span class="ruby-ivar">@amount</span>,
      <span class="ruby-value">context:</span> <span class="ruby-string">&quot;none&quot;</span>,
      <span class="ruby-value">customer:</span> <span class="ruby-ivar">@customer</span>,
      <span class="ruby-value">flag:</span> <span class="ruby-ivar">@flag</span>,
      <span class="ruby-value">code:</span> <span class="ruby-ivar">@code</span>,
      <span class="ruby-value">region:</span> <span class="ruby-keyword">nil</span>,
      <span class="ruby-value">lat:</span> <span class="ruby-ivar">@lat</span>,
      <span class="ruby-value">lon:</span> <span class="ruby-ivar">@lon</span>
  )

  <span class="ruby-comment">#On demarre l&#39;enregistrement des informations</span>
  <span class="ruby-identifier">h</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-signin" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">signin</span><span
            class="method-args">(argc, locale, message)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>AUTHENTIFICATION-CONNEXION D&#39;UN UTILISATEUR SUR LA PLATEFORME</p>

<pre>@name Client::signin
@author @mvondoyannick
@version 1.0.1.1
@param [Object] argc
@param [Object] locale
@param [Object] message</pre>
          
          

          
          <div class="method-source-code" id="signin-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 412</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">signin</span>(<span class="ruby-identifier">argc</span>, <span class="ruby-identifier">locale</span>, <span class="ruby-identifier">message</span>) <span class="ruby-comment"># prévoir l&#39;ajout de l&#39;@ IP</span>
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:phone</span>] <span class="ruby-comment"># Customer phone account</span>
  <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:password</span>] <span class="ruby-comment"># customer password account</span>
  <span class="ruby-ivar">@device_id</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:device_id</span>] <span class="ruby-comment"># customer uniq device ID</span>
  <span class="ruby-ivar">@locale</span> = <span class="ruby-identifier">locale</span>
  <span class="ruby-ivar">@message</span> = <span class="ruby-identifier">message</span>

  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Authenticating user #{@phone} call ...&quot;</span>

  <span class="ruby-comment">#customer = Customer.where(phone: @phone).first</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>) <span class="ruby-comment"># REFACTORING</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@password</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">two_fa</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;authenticate&quot;</span>

        <span class="ruby-comment"># check customer device</span>
        <span class="ruby-comment"># if device({device: @device_id, phone: @phone}, @locale)</span>

          <span class="ruby-comment"># a ce stade, tout est true, donc tout va bien</span>
          <span class="ruby-comment"># on retourne les informations</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Utilisateur et devise indentique&quot;</span>

          <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> [<span class="ruby-value">:name</span>, <span class="ruby-value">:second_name</span>, <span class="ruby-value">:authentication_token</span>, <span class="ruby-value">:code</span>])

        <span class="ruby-comment"># else</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment">#   # rien ne va!</span>
        <span class="ruby-comment">#   Rails::logger::info &quot;Les informations du terminal de cet urilisateur sont differents de ceux contenu dans la base, il doit s&#39;authentifier&quot;</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment">#   # sending SMS to authenticate customer</span>
        <span class="ruby-comment">#   @codeSms = Parametre::Authentication::auth_top(@phone, &#39;context&#39;)</span>
        <span class="ruby-comment">#   if @codeSms[0]</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment">#     return true, I18n.t(&quot;enterSms&quot;, locale: locale), &quot;authenticate&quot;</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment">#   else</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment">#     return false, &quot;Nous rencontrons des difficultés pour vous faire parvenir votre code SMS, un opérateur #{App::PayMeQuick::App::app[:signature]} vous contactera sous une minute.&quot;</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment">#   end</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment"># end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@account_status</span> = <span class="ruby-identifier">isLock?</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">authentication_token</span>)

        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Compte #{@phone} est actuellement #{customer.two_fa}&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Le statut actuel de votre compte ne vous permet pas de vous connecter. Bien vouloir vous rapprocher d&#39;un POINT #{App::PayMeQuick::App::app[:signature]} ou réinitialiser votre mot de passe.&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Authenticating user failed, bad password. end request!&quot;</span>

      <span class="ruby-comment"># on enregistre cet essaie de mauvais mot de passe dans la base de données, ainsi les informations supplementaires</span>

      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu ou mot de passe invalide.&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-string">&quot;Authenticating user failled, unknow user. end request!&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;customerNotFound&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>), <span class="ruby-value">status:</span> <span class="ruby-value">:unauthorized</span> <span class="ruby-comment">#&quot;Utilisateur inconnu ou mot de passe invalide.&quot;, status: :unauthorized</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-signup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">signup</span><span
            class="method-args">(argv, message, locale)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>CREATION DU COMPTE CLIENT 
<dd>
<p>refactoring</p>
</dd></dl>

<pre>@param [String] name
@param [String] second_name
@param [Integer] phone
@param [String] cni
@param [String] password
@param [String] sexe
@param [Integer] question
@param [String] answer
@param [String] IP
@version 1.0.1</pre>
          
          

          
          <div class="method-source-code" id="signup-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 46</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">signup</span>(<span class="ruby-identifier">argv</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">locale</span>)
  <span class="ruby-comment">#include ActionDispatch</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Datas sugnup are : #{argv}&quot;</span>

  <span class="ruby-keyword">begin</span>

    <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:name</span>]
    <span class="ruby-ivar">@second_name</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:second_name</span>]
    <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:phone</span>]
    <span class="ruby-comment"># @cni = argv[:cni]</span>
    <span class="ruby-ivar">@email</span> = <span class="ruby-node">&quot;#{Faker::Internet.email}&quot;</span>
    <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:password</span>]
    <span class="ruby-ivar">@sexe</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:sexe</span>]
    <span class="ruby-ivar">@ip</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:ip</span>]
    <span class="ruby-ivar">@question</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:question</span>]
    <span class="ruby-ivar">@answer</span> = <span class="ruby-identifier">argv</span>[<span class="ruby-value">:answer</span>]

    <span class="ruby-ivar">@locale</span> = <span class="ruby-identifier">locale</span> <span class="ruby-comment"># Pour la traduction, fr ou en</span>

    <span class="ruby-comment">#on recherche le pays</span>
    <span class="ruby-ivar">@pays</span> = <span class="ruby-constant">DistanceMatrix</span><span class="ruby-operator">::</span><span class="ruby-constant">DistanceMatrix</span>.<span class="ruby-identifier">pays</span>(<span class="ruby-ivar">@ip</span>)

    <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Requete provenant de l&#39;IP #{@ip}, du pays : #{@pays}&quot;</span>

    <span class="ruby-comment"># Check if password is don&#39;t rejected ::  FRAUD inclusion</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">Fraud</span><span class="ruby-operator">::</span><span class="ruby-constant">Customer</span>.<span class="ruby-identifier">passwordValidation</span>(<span class="ruby-ivar">@password</span>)[<span class="ruby-value">0</span>]

      <span class="ruby-comment"># password is OK and don&#39;t have restricted informations</span>
      <span class="ruby-comment">#initi customer creation</span>
      <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">new</span>(
          <span class="ruby-value">name:</span> <span class="ruby-ivar">@name</span>,
          <span class="ruby-value">second_name:</span> <span class="ruby-ivar">@second_name</span>,
          <span class="ruby-value">phone:</span> <span class="ruby-ivar">@phone</span>,
          <span class="ruby-value">email:</span> <span class="ruby-ivar">@email</span>,
          <span class="ruby-value">password:</span> <span class="ruby-ivar">@password</span>,
          <span class="ruby-value">type_id:</span> <span class="ruby-value">1</span>,
          <span class="ruby-comment">#cni: @cni,</span>
          <span class="ruby-value">sexe:</span> <span class="ruby-ivar">@sexe</span>,
          <span class="ruby-value">ip:</span> <span class="ruby-ivar">@ip</span>,
          <span class="ruby-value">pays:</span> <span class="ruby-ivar">@pays</span>
      )

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">save</span>

          <span class="ruby-comment"># on enregistre la question de securité</span>
          <span class="ruby-identifier">pSecurityQuestion</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">SecurityQuestion</span><span class="ruby-operator">::</span><span class="ruby-identifier">setSecurityQuestion</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>, <span class="ruby-ivar">@question</span>, <span class="ruby-ivar">@answer</span>)
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Sauvegarder des données personnelles : #{pSecurityQuestion}&quot;</span>

          <span class="ruby-ivar">@otp</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Authentication</span><span class="ruby-operator">::</span><span class="ruby-identifier">auth_top</span>(<span class="ruby-ivar">@phone</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@otp</span>[<span class="ruby-value">0</span>]
            <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Le compte #{@phone} vient de se faire envoyer le SMS de confirmation&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> <span class="ruby-value">:phone</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#notified admin for these errors, customer could not receive SMS confirmation</span>

            <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-constant">PayMeQuick</span><span class="ruby-operator">::</span><span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-identifier">developer</span>[<span class="ruby-value">:phone</span>], <span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-constant">Messages</span><span class="ruby-operator">::</span><span class="ruby-constant">Signup</span><span class="ruby-operator">::</span><span class="ruby-identifier">confirmation</span>[<span class="ruby-value">:sms</span>][<span class="ruby-value">:confirmation_failed</span>])

            <span class="ruby-keyword">return</span> <span class="ruby-ivar">@otp</span>[<span class="ruby-value">1</span>], <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;SmsNotSend&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>) <span class="ruby-comment">#&quot;Hum!!! c&#39;est vraiment génant, nous sommes dans l&#39;incapacité de vous transmettre le SMS de confirmarion&quot;</span>

          <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">else</span>
          <span class="ruby-comment">#Rails::logger::info {&quot;Creation de de l&#39;utiliateur #{@phone} impossible : #{customer.errors.full_messages}&quot;}</span>

          <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-constant">PayMeQuick</span><span class="ruby-operator">::</span><span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-identifier">developer</span>[<span class="ruby-value">:phone</span>], <span class="ruby-constant">App</span><span class="ruby-operator">::</span><span class="ruby-constant">Messages</span><span class="ruby-operator">::</span><span class="ruby-constant">Signup</span><span class="ruby-operator">::</span><span class="ruby-identifier">confirmation</span>[<span class="ruby-value">:sms</span>][<span class="ruby-value">:customer_exist</span>])

          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Des erreurs sont survenues : #{customer.errors.full_messages}&quot;</span>

        <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">else</span>

      <span class="ruby-comment">#this password is restricted</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;PasswordNotSecure&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>) <span class="ruby-comment">#&quot;Le mot de passe que vous avez choisis est non seulement faible, mais pour des raisons de securité est interndit. Merci de le modifier et de réessayer&quot;</span>

    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Une autre erreur est survenue : #{e}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-transfert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">transfert</span><span
            class="method-args">(from, to, amount, password)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@param [Object] from @param [Object] to @param [Object] amount @param
[Object] password @author @mvondoyannick @version 0.0.1beta-rev-11-03-83-50
@deprecated</p>
          
          

          
          <div class="method-source-code" id="transfert-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 1545</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">transfert</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">amount</span>, <span class="ruby-identifier">password</span>)
  <span class="ruby-ivar">@from</span> = <span class="ruby-identifier">from</span>
  <span class="ruby-ivar">@to</span> = <span class="ruby-identifier">to</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>
  <span class="ruby-ivar">@client_password</span> = <span class="ruby-identifier">password</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@from</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@to</span>
    <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@from</span>, <span class="ruby-node">&quot;Expediteur et Receveur ne peuvent etre identique, merci de changer. #{$signature}&quot;</span>)
    <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
    <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{@from} et #{@to} ne peuvent etre indentique. #{$signature}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#on commernce par rechercher si le receveur appartient au reseaux</span>
    <span class="ruby-identifier">marchand</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">phone:</span> <span class="ruby-ivar">@to</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment">#personne qui recoit</span>
    <span class="ruby-identifier">marchand_account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">customer_id:</span> <span class="ruby-identifier">marchand</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment">#le montant de la personne qui recoit</span>
    <span class="ruby-identifier">client</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">phone:</span> <span class="ruby-ivar">@from</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment">#la personne qui envoi</span>
    <span class="ruby-identifier">client_account</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">customer_id:</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">id</span>) <span class="ruby-comment"># le montant de la personne qui envoi</span>
    <span class="ruby-comment">#on authentifie le client a l&#39;aide de son telephone et de son password</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@client_password</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">client_account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@amount</span>
        <span class="ruby-ivar">@hash</span> = <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">hex</span>(<span class="ruby-value">13</span>).<span class="ruby-identifier">upcase</span>
        <span class="ruby-identifier">marchand_account</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-identifier">marchand_account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@amount</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">marchand_account</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-identifier">client_account</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-identifier">client_account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@amount</span>

          <span class="ruby-comment">#on inscrit dans l&#39;historique du marchand</span>
          <span class="ruby-constant">Journal</span><span class="ruby-operator">::</span><span class="ruby-constant">Journal</span><span class="ruby-operator">::</span><span class="ruby-identifier">create_logs_transaction</span>(<span class="ruby-ivar">@from</span>, <span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@amount</span>, <span class="ruby-string">&quot;credit&quot;</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">client_account</span>.<span class="ruby-identifier">save</span>

            <span class="ruby-comment">#on inscrit le journal du client concernant sa transaction</span>
            <span class="ruby-constant">Journal</span><span class="ruby-operator">::</span><span class="ruby-constant">Journal</span><span class="ruby-operator">::</span><span class="ruby-identifier">create_logs_transaction</span>(<span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@from</span>, <span class="ruby-ivar">@amount</span>, <span class="ruby-string">&quot;debit&quot;</span>)

            <span class="ruby-comment">#Envoi des SMS de confirmations de la transaction</span>
            <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@to</span>, <span class="ruby-node">&quot;Le paiement du montant #{@amount} FC provenant de #{client.name} #{client.second_name} c est correctement deroule. Votre solde est maintenant de #{marchand_account.amount} FC. ID Transaction : #{@hash}. #{$signature}&quot;</span>)
            <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
            <span class="ruby-comment">#----------------------------------</span>
            <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@from</span>, <span class="ruby-node">&quot;#{prettyCallSexe(client.sexe)} #{client.name} #{client.second_name}, #{@amount} FC ont ete debite de votre compte, le solde actuel de votre compte est #{client_account.amount} FC. ID Transaction : #{@hash}. #{$signature}&quot;</span>)
            <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
            <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;Le paiement du montant #{@amount} FC provenant de #{client.name} #{client.second_name} c est correctement deroule. ID Transaction : #{@hash}. #{$signature}&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;Echec du paiement du montant #{@amount} FC. Echec de la transaction ID Transaction : #{@hash}. #{$signature}&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;une erreur est survenue durant le traitement&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@from</span>, <span class="ruby-node">&quot;Montant du compte insuffisant. #{$signature}&quot;</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Impossible d&#39;effectuer le transfert, le montant est insuffisant&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@from</span>, <span class="ruby-node">&quot;Transaction annulee, mot de passe invalide. #{$signature}&quot;</span>)
      <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-updateDevice" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">updateDevice</span><span
            class="method-args">(argc)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>UPDATE DEVICE NEW UUID CUSTOMER</p>

<pre>@param [Object] argc</pre>
          
          

          
          <div class="method-source-code" id="updateDevice-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 358</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">updateDevice</span>(<span class="ruby-identifier">argc</span>)
  <span class="ruby-ivar">@uuid</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:uuid</span>]
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-ivar">@sms</span> = <span class="ruby-identifier">argc</span>[<span class="ruby-value">:sms</span>]

  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Customer Unknow&quot;</span> <span class="ruby-comment">#I18n.t(&#39;lore&#39;)</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># check SMS and</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-constant">CustomerDatum</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">uuid2:</span> <span class="ruby-ivar">@uuid</span>, <span class="ruby-value">phone:</span> <span class="ruby-ivar">@phone</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">blank?</span>

      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Rien de similaire trouvé, les UUID2 ne sont pas correspondant&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Il semble que vous essayez d&#39;acceder à partir d&#39;un nouveau terminal non reconnu. Pour des raisons de sécurité, merci de confirmer qu&#39;il s&#39;agis bien de vous!!&quot;</span>

    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># request SMS authentication</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">two_fa</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@sms</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Update information two_fa of customer&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">two_fa:</span> <span class="ruby-string">&#39;authenticate&#39;</span>)

          <span class="ruby-comment">#mise a jour de l&#39;uuid premium</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">device:</span> <span class="ruby-ivar">@uuid</span>)

            <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Customer has be authenticated ... welcome Mr #{customer.name}&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;Utilisateur authentifié avec succès. Content de vous revoir Mr/Mme #{customer.name} #{customer.second_name}&quot;</span>

          <span class="ruby-keyword">else</span>

            <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Impossible de mettre a jour le nouvel UUID&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Impossible d&#39;ajouter votre nouveau terminal sur #{App::PayMeQuick::App::app[:signature]}&quot;</span>

          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Update two_fa is impossible&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Impossible de mettre à jour vos information d&#39;authentication&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Les informations du SMS ne sont pas indentique&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Le code SMS ne semble pas etre correcte, merci de réessayer!&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-update_account_client" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_account_client</span><span
            class="method-args">(id, amount)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>MISE A JOUR DES MONTANTS DU COMPTES</p>

<pre>@param [Object] id
@param [Object] amount
@return [Object]
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="update_account_client-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 679</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_account_client</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">amount</span>)
  <span class="ruby-ivar">@id</span> = <span class="ruby-identifier">id</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>

  <span class="ruby-identifier">response</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">response</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@amount</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;failed&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-update_account_marchand" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_account_marchand</span><span
            class="method-args">(id, amount)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>MISE A JOUR DES MONTANTS DU COMPTE MARCHAND</p>

<pre>@param [Object] id
@param [Object] amount
@return [Object]
@author @mvondoyannick
@version 0.0.1beta-rev-11-03-83-50</pre>
          
          

          
          <div class="method-source-code" id="update_account_marchand-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 703</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">update_account_marchand</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">amount</span>)
  <span class="ruby-ivar">@id</span> = <span class="ruby-identifier">id</span>
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">amount</span>

  <span class="ruby-identifier">response</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">response</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@amount</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;failed&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-validate_retrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_retrait</span><span
            class="method-args">(token, pwd)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>VALIDATION DU RETRAIT PAR LE CUSTOMER 
<dd>
<p>REFACTORING UPDATE</p>
</dd></dl>

<pre>@param [String] token
@param [String] pwd
@author @mvondoyannick
@version 1.0.1
TODO ajouter l&#39;agent de la requete, celui qui initie l&#39;oparation et retrait et se voit virer l&#39;argent une fois la validation effectuée
TODO verifier et finaliser cette procedure de validation de retrait</pre>
          
          

          
          <div class="method-source-code" id="validate_retrait-source">
            <pre><span class="ruby-comment"># File app/modules/client.rb, line 894</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">validate_retrait</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">pwd</span>)
  <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">token</span>
  <span class="ruby-ivar">@pwd</span> = <span class="ruby-identifier">pwd</span>
  <span class="ruby-ivar">@hash</span> = <span class="ruby-node">&quot;PR-#{SecureRandom.hex(13).upcase}&quot;</span> <span class="ruby-comment">#ID de la transaction</span>

  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
  <span class="ruby-comment"># refactoring</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@pwd</span>)

      <span class="ruby-comment"># Recherche si le customer a une intention de retrait</span>
      <span class="ruby-identifier">awaits</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-comment"># Can&#39;t continu, not intend await found</span>

        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Aucun retrait trouvé pour #{customer.complete_name}&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-node">&quot;Aucun retrait trouvé pour votre compte #{customer.phone}&quot;</span>

      <span class="ruby-keyword">else</span>
        <span class="ruby-comment"># an await exist, continuation into process</span>
        <span class="ruby-identifier">customer_abonnement</span> = <span class="ruby-constant">Abonnements</span><span class="ruby-operator">::</span><span class="ruby-constant">Abonnements</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>)

        <span class="ruby-comment"># On recherche le palier d&#39;abonnement du client et voir le max qu&#39;il peut retirer</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer_abonnement</span>[<span class="ruby-value">0</span>]
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{customer.complete_name} a un palier lui permettant de faire un retrait maximum de #{customer_abonnement[1].to_i} FC&quot;</span>

          <span class="ruby-comment"># Est ce que le montant a retirer est superieur a ce que le palier autorise?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">customer_abonnement</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_f</span>
            <span class="ruby-comment"># Cancel retrait and restare fond</span>
            <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Plafond de retrait maximum atteint pour cette abonnement&quot;</span>

            <span class="ruby-comment"># Starting restauration, and await suppression amount</span>
            <span class="ruby-identifier">restauration</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>.<span class="ruby-identifier">amount</span>

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">restauration</span>.<span class="ruby-identifier">to_f</span>)
              <span class="ruby-comment"># before delete await, set it&#39;s amount to nil</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-keyword">nil</span> )
                <span class="ruby-comment"># delete customer await intend</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">destroy</span>
                  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Suppression de l&#39;intention de retrait du customer ...DONE!&quot;</span>

                  <span class="ruby-comment"># send notification</span>
                  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Ce retrait est au dessus de la limite maximum de votre plafond retrait, impossible effectuer le retrait. merci de revoir le montant à la baisse et de réessayer.&quot;</span>
                <span class="ruby-keyword">else</span>
                  <span class="ruby-comment"># si on ne peut pas detruire cela, on notify les administrateurs et on mets le compte a jour avec une valeur nil</span>
                  <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sms_to_many</span>({<span class="ruby-value">yannick:</span> <span class="ruby-value">691451189</span>, <span class="ruby-value">nana:</span> <span class="ruby-value">698500871</span>, <span class="ruby-value">boss:</span> <span class="ruby-value">697970210</span>}, <span class="ruby-node">&quot;Impossible de supprimer l&#39;intention de retrait du client N° #{customer.complete_name} ayant l&#39;ID #{await.id}&quot;</span>)
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-comment"># force updating</span>
                <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">update!</span>(<span class="ruby-value">amount:</span> <span class="ruby-keyword">nil</span> )

                <span class="ruby-comment">#notify somes administrator</span>
                <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sms_to_many</span>({<span class="ruby-value">yannick:</span> <span class="ruby-value">691451189</span>, <span class="ruby-value">nana:</span> <span class="ruby-value">698500871</span>, <span class="ruby-value">boss:</span> <span class="ruby-value">697970210</span>}, <span class="ruby-node">&quot;Impossible de supprimer l&#39;intention de retrait du client N° #{customer.complete_name} ayant l&#39;ID #{await.id}&quot;</span>)
              <span class="ruby-keyword">end</span>

            <span class="ruby-keyword">else</span>
              <span class="ruby-comment"># Failed to update customer restauration</span>
              <span class="ruby-comment"># raise ActiveRecord::Rollback &quot;Restauration en cours ...&quot;</span>
              <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Une erreur est survenue durant la restauration du compte #{customer.complete_name}, impossible de restaures son compte&quot;</span>

              <span class="ruby-comment"># Notify admins</span>
              <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sms_to_many</span>({<span class="ruby-value">yannick:</span> <span class="ruby-value">691451189</span>, <span class="ruby-value">nana:</span> <span class="ruby-value">698500871</span>, <span class="ruby-value">boss:</span> <span class="ruby-value">697970210</span>}, <span class="ruby-node">&quot;Impossible de restaurer le compte du client N° #{customer.complete_name} ayant l&#39;ID #{customer.id}, merci de rapidement intervenir!&quot;</span>)

              <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-string">&quot;Reinitialisation des comptes aux status initials&quot;</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>

            <span class="ruby-comment">#il existe effectivement un intent de retrait pour ce customer</span>
            <span class="ruby-comment">#on verifie si ce retrait est encore valide ou perimé</span>
            <span class="ruby-keyword">if</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">end</span>.<span class="ruby-identifier">to_time</span>
              <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Intention de retrait périmé, retrait annulé!&quot;</span>

              <span class="ruby-comment"># On effectue le rembourssement du retrait au client</span>
              <span class="ruby-identifier">account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span> <span class="ruby-comment">#Account.find_by_customer_id(customer.id)</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">blank?</span>
                <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Impossible de trouver le compte de l&#39;utilisateur #{customer.id}&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Compte inexistant&quot;</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-comment">#processus de retrocession</span>
                <span class="ruby-comment"># retro = account.amount += awaits.amount.to_f</span>
                <span class="ruby-comment"># if account.update(amount: retro)</span>
                <span class="ruby-comment">#   Rails::logger::info &quot;Montant remboursé avec succes&quot;</span>
                <span class="ruby-comment">#</span>
                <span class="ruby-comment">#   #on supprime ensuite l&#39;intent de retrait dans Await</span>
                <span class="ruby-comment">#   Rails::logger::info &quot;Suppression de l&#39;intent de retrait&quot;</span>
                <span class="ruby-comment">#   awaits.destroy</span>
                <span class="ruby-comment">#</span>
                <span class="ruby-comment">#   #on remet a jour le flag await sur le customer</span>
                <span class="ruby-comment">#   Rails::logger::info &quot;Mise a jour de user&quot;</span>
                <span class="ruby-comment">#   customer.update(await: nil)</span>

                <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Suppression de l&#39;intent de retrait ...&quot;</span>
                <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">destroy</span>

                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;Retrait perimé, impossible de continuer&quot;</span>
                <span class="ruby-comment"># else</span>
                <span class="ruby-comment">#   Rails::logger::info &quot;Impossible de mettre à jour le remboursement&quot;</span>
                <span class="ruby-comment">#   return false, &quot;Votre rembourssement a echoué, merci de vous rapprocher d&#39;une agence Express Union&quot;</span>
                <span class="ruby-comment"># end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-comment">#tout va bien, on procede a la validation du retrait</span>

              <span class="ruby-identifier">account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span> <span class="ruby-comment">#Account.find_by_customer_id(customer.id)</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">blank?</span>
                <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Compte inconnu&quot;</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-comment"># on debit effectivement le compte client</span>
                <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Suppression de l&#39;intent de retrait ...&quot;</span>

                <span class="ruby-comment"># introduction de l&#39;agent dans le processus, credit du compte de l&#39;agent</span>
                <span class="ruby-identifier">agent</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>.<span class="ruby-identifier">agent</span> <span class="ruby-comment"># Retourne le token de l&#39;agent</span>

                <span class="ruby-comment"># Credit du compte de l&#39;agent</span>
                <span class="ruby-keyword">if</span> <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-string">&quot;691451189&quot;</span>).<span class="ruby-identifier">account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">await</span>.<span class="ruby-identifier">amount</span>)
                  <span class="ruby-comment"># save history</span>
                  <span class="ruby-comment">#enregistrement de l&#39;historique du retrait</span>
                  <span class="ruby-identifier">transaction</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
                      <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>,
                      <span class="ruby-value">code:</span> <span class="ruby-ivar">@hash</span>,
                      <span class="ruby-value">flag:</span> <span class="ruby-string">&quot;retrait&quot;</span>.<span class="ruby-identifier">upcase</span>,
                      <span class="ruby-value">context:</span> <span class="ruby-string">&quot;none&quot;</span>,
                      <span class="ruby-value">amount:</span> <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_s</span>
                  )

                  <span class="ruby-comment">#on enregistre l&#39;historique</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">transaction</span>.<span class="ruby-identifier">save</span>

                    <span class="ruby-comment"># on met a jour le compte de l&#39;agent et on le notifie</span>
                    <span class="ruby-identifier">customer_agent</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-string">&quot;691451189&quot;</span>)
                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer_agent</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-identifier">customer_agent</span>.<span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">amount</span>.<span class="ruby-identifier">to_f</span>)
                      <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Mise a jour du compte de l&#39;agent qui a initialiser le process de retrait ... FAIT!&quot;</span>

                      <span class="ruby-comment"># Notification de l&#39;agent</span>
                      <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-string">&quot;691451189&quot;</span>, <span class="ruby-node">&quot;Retrait effectue du compte #{customer.phone}. Credit de votre compte : #{agent.complete_name} d&#39;un montant de #{awaits.amount.round(2)} FC. Votre solde total est de #{agent.account.amount.round(2)} FC. Vous pouvez payer !&quot;</span>)

                      <span class="ruby-comment"># on supprime l&#39;intent de retrait</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-identifier">awaits</span>.<span class="ruby-identifier">destroy</span>

                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>, <span class="ruby-node">&quot;#{awaits.amount} FC ont été retiré de votre compte. \t Votre solde est de #{account.amount} FC. Merci&quot;</span>

                      <span class="ruby-keyword">else</span>

                        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Une erreur est survenue, engagement d&#39;ActiveRecord::RollBack&quot;</span>
                        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-string">&quot;Annulation de la transaction car Une erreur est survenu durant la transaction&quot;</span>
                        <span class="ruby-comment">#return false, &quot;Une erreur est survenu durant la transaction&quot;</span>

                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">else</span>

                      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Impossible de mettre a jour le compte de l&#39;agent&quot;</span>

                    <span class="ruby-keyword">end</span>

                  <span class="ruby-keyword">else</span>
                    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-string">&quot;Une erreur est survenue durant la mise à jour des informations. merci de vous rapprocher d&#39;un point Express Union.&quot;</span>
                    <span class="ruby-comment">#return false, &quot;Une erreur est survenue durant la mise à jour des informations. merci de vous rapprocher d&#39;un point Express Union.&quot;</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">else</span>
                  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Rollback</span> <span class="ruby-string">&quot;Impossible de continuer&quot;</span>
                  <span class="ruby-comment"># RollBack</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Impossible de determiner le palier d&#39;appartenance du customer&quot;</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Impossible de determiner votre Palier, merci de vous abonner à un palier et de revenir effectuer un retrait &quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">error</span> <span class="ruby-string">&quot;Mot de passe invalide pour ce compte. transaction annulée&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>, <span class="ruby-string">&quot;Mot de passe invalide&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># fin du refactoring</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.0.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

