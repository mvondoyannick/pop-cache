<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Api::V1::SessionController - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../../ApplicationController.html">ApplicationController</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-authNewUuidDevice">#authNewUuidDevice</a>
    
    <li ><a href="#method-i-authorization">#authorization</a>
    
    <li ><a href="#method-i-cancel_retrait">#cancel_retrait</a>
    
    <li ><a href="#method-i-checkPhone">#checkPhone</a>
    
    <li ><a href="#method-i-checkToken">#checkToken</a>
    
    <li ><a href="#method-i-check_retrait">#check_retrait</a>
    
    <li ><a href="#method-i-detailCategorie">#detailCategorie</a>
    
    <li ><a href="#method-i-getPhoneNumber">#getPhoneNumber</a>
    
    <li ><a href="#method-i-getSoldeCustomer">#getSoldeCustomer</a>
    
    <li ><a href="#method-i-getSpData">#getSpData</a>
    
    <li ><a href="#method-i-get_balance">#get_balance</a>
    
    <li ><a href="#method-i-histo">#histo</a>
    
    <li ><a href="#method-i-histoDetail">#histoDetail</a>
    
    <li ><a href="#method-i-history">#history</a>
    
    <li ><a href="#method-i-historyByDate">#historyByDate</a>
    
    <li ><a href="#method-i-p">#p</a>
    
    <li ><a href="#method-i-question">#question</a>
    
    <li ><a href="#method-i-rechargeSprintPay">#rechargeSprintPay</a>
    
    <li ><a href="#method-i-resetPassword">#resetPassword</a>
    
    <li ><a href="#method-i-retrivePassword">#retrivePassword</a>
    
    <li ><a href="#method-i-service">#service</a>
    
    <li ><a href="#method-i-serviceCategorie">#serviceCategorie</a>
    
    <li ><a href="#method-i-signin">#signin</a>
    
    <li ><a href="#method-i-signup">#signup</a>
    
    <li ><a href="#method-i-signup_authentication">#signup_authentication</a>
    
    <li ><a href="#method-i-solde">#solde</a>
    
    <li ><a href="#method-i-testNetwork">#testNetwork</a>
    
    <li ><a href="#method-i-transaction">#transaction</a>
    
    <li ><a href="#method-i-updateAccount">#updateAccount</a>
    
    <li ><a href="#method-i-updatePassword">#updatePassword</a>
    
    <li ><a href="#method-i-validate_retrait">#validate_retrait</a>
    
    <li ><a href="#method-i-virtualSP">#virtualSP</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Api::V1::SessionController">
  <h1 id="class-Api::V1::SessionController" class="class">
    class Api::V1::SessionController
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-authNewUuidDevice" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authNewUuidDevice</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update customer device uuis</p>
          
          

          
          <div class="method-source-code" id="authNewUuidDevice-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 265</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">authNewUuidDevice</span>
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-ivar">@sms</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:code</span>]
  <span class="ruby-ivar">@uuid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:uuid</span>]

  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Starting adding new uuid devices #{@uuid}&quot;</span>
  <span class="ruby-identifier">query</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">updateDevice</span>(<span class="ruby-value">uuid:</span> <span class="ruby-ivar">@uuid</span>, <span class="ruby-value">phone:</span> <span class="ruby-ivar">@phone</span>, <span class="ruby-value">sms:</span> <span class="ruby-ivar">@sms</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
    <span class="ruby-value">status:</span> <span class="ruby-identifier">query</span>[<span class="ruby-value">0</span>],
    <span class="ruby-value">message:</span> <span class="ruby-identifier">query</span>[<span class="ruby-value">1</span>],
  }
  
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-authorization" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authorization</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>verificatin d&#39;un utilisateur et validation de son pwd</p>
          
          

          
          <div class="method-source-code" id="authorization-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 908</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">authorization</span>
  <span class="ruby-ivar">@token</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:token</span>]
  <span class="ruby-ivar">@pwd</span>      = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]

  <span class="ruby-comment">#recherche du customer</span>
  <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
        <span class="ruby-value">flag:</span>     <span class="ruby-value">:customer_not_found</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@pwd</span>)
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-value">:success</span>,
        <span class="ruby-value">flag:</span>     <span class="ruby-value">:customer_found</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> [<span class="ruby-value">:name</span>, <span class="ruby-value">:second_name</span>, <span class="ruby-value">:phone</span>, <span class="ruby-value">:sexe</span>, <span class="ruby-value">:cni</span>])
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#head(&quot;unauthorize&quot;)</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
          <span class="ruby-value">flag:</span>     <span class="ruby-value">:customer_unauthorize</span>,
          <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Numero de telephone ou mot de passe invalide&quot;</span>
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cancel_retrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cancel_retrait</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CANCEL CUSTOMER INTENT RETRAIT</p>

<pre>permet d&#39;annuler le retrait en cours</pre>
          
          

          
          <div class="method-source-code" id="cancel_retrait-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 370</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cancel_retrait</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;HTTP_X_API_POP_KEY&#39;</span>]
  <span class="ruby-identifier">locale</span> = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&#39;HTTP_LOCALE&#39;]</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">cancel</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">cancelRetrait</span>({<span class="ruby-value">token:</span> <span class="ruby-identifier">token</span>}, <span class="ruby-string">&quot;Annulation de la procedure de retrait&quot;</span>, <span class="ruby-identifier">locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">message:</span> <span class="ruby-identifier">cancel</span>
    }
  <span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">exception</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">error:</span> <span class="ruby-identifier">exception</span>
    }
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-checkPhone" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">checkPhone</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Verifier si un telephone appartient a la plateforme</p>
          
          

          
          <div class="method-source-code" id="checkPhone-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 996</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">checkPhone</span>
  <span class="ruby-ivar">@phone</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]

  <span class="ruby-comment">#on demarre les recherches</span>
  <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span>   <span class="ruby-value">404</span>,
      <span class="ruby-value">flag:</span>     <span class="ruby-value">:false</span>,
      <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Numeron inconnu&quot;</span>,
      <span class="ruby-value">data:</span>     <span class="ruby-keyword">nil</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># le telephone a été trouvé sur la plateforme</span>
    <span class="ruby-ivar">@answer</span> = <span class="ruby-constant">Answer</span>.<span class="ruby-identifier">find_by_customer_id</span>(<span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@answer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>  <span class="ruby-value">404</span>,
        <span class="ruby-value">flag:</span>   <span class="ruby-value">:false</span>,
        <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Aucune question trouvée pour cet utilisateur&quot;</span>,
        <span class="ruby-value">data:</span> <span class="ruby-keyword">nil</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#on retourne la question trouvé dans answer</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>     <span class="ruby-value">200</span>,
        <span class="ruby-value">flag:</span>       <span class="ruby-value">:question_found</span>,
        <span class="ruby-value">message:</span>    <span class="ruby-string">&quot;Question trouvée&quot;</span>,
        <span class="ruby-value">question:</span>   <span class="ruby-constant">Question</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@answer</span>.<span class="ruby-identifier">question_id</span>).<span class="ruby-identifier">content</span>,
        <span class="ruby-value">question_id:</span> <span class="ruby-constant">Question</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@answer</span>.<span class="ruby-identifier">question_id</span>).<span class="ruby-identifier">id</span>
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-checkToken" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">checkToken</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CHECK WEB</p>
          
          

          
          <div class="method-source-code" id="checkToken-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 45</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">checkToken</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">strict_decode64</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:qrcode</span>])
    <span class="ruby-identifier">qrcode</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;@&quot;</span>)
    <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-identifier">qrcode</span>[<span class="ruby-value">0</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-keyword">false</span>,
        <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># send SMS</span>
      <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-string">&quot;Merci de confirmer ce payment en entrant votre mot de passe dans la section &lt;RECEVOIR UN PAIEMENT&gt; de l&#39;application PayMeQuick&quot;</span>)
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-keyword">true</span>,
        <span class="ruby-value">message:</span> <span class="ruby-node">&quot;#{Client.prettyCallSexe(customer.sexe)} #{customer.complete_name} ouvrez l&#39;application PayMeQuick et confirmer le paiement&quot;</span>
      }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-check_retrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_retrait</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CHECK CUSTOMER INTENT RETRAIT</p>

<pre class="ruby"><span class="ruby-identifier">verification</span> <span class="ruby-identifier">du</span> <span class="ruby-identifier">retrait</span>
</pre>
          
          

          
          <div class="method-source-code" id="check_retrait-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 354</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">check_retrait</span>
    <span class="ruby-identifier">header</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;HTTP_X_API_POP_KEY&#39;</span>]
    <span class="ruby-identifier">locale</span> = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&quot;HTTP_LOCALE&quot;]</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">check_retrait_refactoring</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
      }
    <span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">exception</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">error:</span> <span class="ruby-identifier">exception</span>
      }
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-detailCategorie" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">detailCategorie</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RENDER CATEGORIES DETAILS</p>
          
          

          
          <div class="method-source-code" id="detailCategorie-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">detailCategorie</span>
  <span class="ruby-identifier">id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-identifier">detailCat</span> = <span class="ruby-constant">Cat</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">cat_id:</span> <span class="ruby-identifier">id</span>, <span class="ruby-value">name:</span> <span class="ruby-value">:asc</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">cat_detail:</span> <span class="ruby-identifier">detailCat</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-getPhoneNumber" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getPhoneNumber</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RENDER CUSTOMER PHONE WITH HEADER</p>

<pre class="ruby"><span class="ruby-ivar">@deprecated</span>
</pre>
          
          

          
          <div class="method-source-code" id="getPhoneNumber-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 645</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">getPhoneNumber</span>
  <span class="ruby-identifier">header</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;HTTP_X_API_POP_KEY&#39;</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">header</span>.<span class="ruby-identifier">present?</span>

    <span class="ruby-comment"># on recherche le customer</span>
    <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-identifier">header</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span> <span class="ruby-value">:not_found</span>,
          <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span> <span class="ruby-value">:found</span>,
          <span class="ruby-value">message:</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">phone</span>
      }
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-value">:unprocessable_entity</span>,
        <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Certaines informations sont manquantes&quot;</span>
    }

  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-getSoldeCustomer" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getSoldeCustomer</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="getSoldeCustomer-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 320</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">getSoldeCustomer</span>
  <span class="ruby-ivar">@phone</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:customer</span>]
  <span class="ruby-ivar">@pwd</span>      = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-ivar">@playerId</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:oneSignalID</span>]
  <span class="ruby-identifier">locale</span> = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&quot;HTTP_LOCALE&quot;]</span>

  <span class="ruby-comment">#verificatin du customer</span>
  <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span>   <span class="ruby-value">404</span>,
      <span class="ruby-value">flag:</span>     <span class="ruby-value">:customer_not_found</span>,
      <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">balance</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_balance</span>({<span class="ruby-value">phone:</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-value">password:</span> <span class="ruby-ivar">@pwd</span>}, <span class="ruby-string">&quot;Obtention crédit compte client&quot;</span>, <span class="ruby-identifier">locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">balance</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-value">200</span>,
        <span class="ruby-value">flag:</span>     <span class="ruby-value">:success</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-identifier">balance</span>[<span class="ruby-value">1</span>]
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-value">404</span>,
        <span class="ruby-value">flag:</span>     <span class="ruby-value">:errors</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-identifier">balance</span>[<span class="ruby-value">1</span>]
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-getSpData" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getSpData</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>IDENTIFICATION DES DONN2ES DE RECHARGES RECU PAR LE CLIENT</p>

<pre class="ruby"><span class="ruby-ivar">@return</span> [<span class="ruby-constant">Object</span>]
</pre>
          
          

          
          <div class="method-source-code" id="getSpData-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 562</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">getSpData</span>
  <span class="ruby-ivar">@token</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:token</span>]
  <span class="ruby-ivar">@phone</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-ivar">@amount</span>   = <span class="ruby-identifier">params</span>[<span class="ruby-value">:amount</span>]

  <span class="ruby-comment">#reduction des requetes inutiles</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@token</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@phone</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">present?</span>

    <span class="ruby-comment">#on recherche l&#39;utilisateur</span>
    <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>   <span class="ruby-value">404</span>,
          <span class="ruby-value">flag:</span>     <span class="ruby-value">:customer_not_found</span>,
          <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@status</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">PersonalData</span><span class="ruby-operator">::</span><span class="ruby-identifier">numeroOperateurMobile</span>(<span class="ruby-ivar">@phone</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;orange&quot;</span>
        <span class="ruby-comment">#on formate la nouvelle image</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>         <span class="ruby-value">200</span>,
            <span class="ruby-value">flag:</span>           <span class="ruby-value">:success</span>,
            <span class="ruby-value">phone:</span>          <span class="ruby-ivar">@phone</span>,
            <span class="ruby-value">amount:</span>         <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_i</span>,
            <span class="ruby-value">network:</span>        <span class="ruby-ivar">@status</span>,
            <span class="ruby-value">operator:</span>       <span class="ruby-string">&quot;ORANGE MONEY&quot;</span>,
            <span class="ruby-value">amount_total:</span>   <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>),
            <span class="ruby-value">logo:</span>           <span class="ruby-node">&quot;#{request.base_url}#{ActionController::Base.helpers.asset_path(&quot;orange.png&quot;)}&quot;</span>
        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;mtn&quot;</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>       <span class="ruby-value">200</span>,
            <span class="ruby-value">flag:</span>         <span class="ruby-value">:success</span>,
            <span class="ruby-value">phone:</span>        <span class="ruby-ivar">@phone</span>,
            <span class="ruby-value">amount:</span>       <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">to_i</span>,
            <span class="ruby-value">network:</span>      <span class="ruby-ivar">@status</span>,
            <span class="ruby-value">operator:</span>     <span class="ruby-string">&quot;MOBILE MONEY&quot;</span>,
            <span class="ruby-value">amount_total:</span> <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-identifier">agis_percentage</span>(<span class="ruby-ivar">@amount</span>),
            <span class="ruby-value">logo:</span>         <span class="ruby-node">&quot;#{request.base_url}#{ActionController::Base.helpers.asset_path(&quot;mtn.jpg&quot;)}&quot;</span>
        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;nexttel&quot;</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>       <span class="ruby-value">404</span>,
            <span class="ruby-value">flag:</span>         <span class="ruby-value">:failed</span>,
            <span class="ruby-value">network:</span>      <span class="ruby-ivar">@status</span>,
            <span class="ruby-value">operator:</span>     <span class="ruby-string">&quot;NEXTTEL POSSA&quot;</span>,
            <span class="ruby-value">message:</span>      <span class="ruby-string">&quot;NEXTTEL POSSA PAS ENCORE SUPPORTE&quot;</span>,
            <span class="ruby-value">logo:</span>         <span class="ruby-node">&quot;#{request.base_url}#{ActionController::Base.helpers.asset_path(&quot;nexttel-possa.png&quot;)}&quot;</span>
        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">inconnu</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">404</span>,
            <span class="ruby-value">flag:</span>     <span class="ruby-value">:failed</span>,
            <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;OPERATEUR NON SUPPORTE&quot;</span>
        }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-value">404</span>,
        <span class="ruby-value">flag:</span>   <span class="ruby-value">:failed</span>,
        <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Informations incorrectes&quot;</span>
    }

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_balance" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_balance</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CUSTOMER ACCOUNT BALANCE</p>
          
          

          
          <div class="method-source-code" id="get_balance-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_balance</span>
  <span class="ruby-identifier">phone</span>       = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-identifier">password</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-ivar">@playerId</span>   = <span class="ruby-identifier">params</span>[<span class="ruby-value">:playerId</span>]

  <span class="ruby-identifier">balance</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_balance</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">password</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> <span class="ruby-identifier">balance</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-histo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">histo</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CUSTOMER HISTORY</p>

<pre>DEPRECATED
TODO Remove this method on next release, deprecatd since 0.1.2</pre>
          
          

          
          <div class="method-source-code" id="histo-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">histo</span> <span class="ruby-comment">#retourn l&#39;historique sur la base du telephone</span>
  <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;HTTP_X_API_POP_KEY&#39;</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span>   <span class="ruby-value">:customer_not_found</span>,
      <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;utilisateur inconnu&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">message:</span> <span class="ruby-constant">Transaction</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">customer:</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">created_at:</span> <span class="ruby-value">:desc</span>).<span class="ruby-identifier">last</span>(<span class="ruby-value">50</span>).<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> [<span class="ruby-value">:date</span>, <span class="ruby-value">:amount</span>, <span class="ruby-value">:flag</span>, <span class="ruby-value">:code</span>, <span class="ruby-value">:color</span>, <span class="ruby-value">:region</span>])
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-histoDetail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">histoDetail</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CUSTOMER ALL HISTORY SINCE BEGINING</p>

<pre>Detail de l&#39;historiqueAnswer.all
TODO deprecated, remove this method on next release</pre>
          
          

          
          <div class="method-source-code" id="histoDetail-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">histoDetail</span>
  <span class="ruby-ivar">@code_transaction</span>   = <span class="ruby-identifier">params</span>[<span class="ruby-value">:transaction</span>]
  <span class="ruby-identifier">detail</span> = <span class="ruby-constant">Transaction</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">code:</span> <span class="ruby-ivar">@code_transaction</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">detail</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Aucune activité correspondante&quot;</span>
    }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">detail</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">data:</span>     <span class="ruby-identifier">detail</span>
    }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">detail</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">message:</span>    <span class="ruby-string">&quot;Impossible de retourner l&#39;activite&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">message:</span>    <span class="ruby-string">&quot;Une erreur est survenue&quot;</span>
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-history" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">history</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>retourne les informations de la semaine entre le début de la semaine et la
fin de la semaine</p>

<pre class="ruby"><span class="ruby-constant">Refactoring</span>
</pre>
          
          

          
          <div class="method-source-code" id="history-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">history</span>
  <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;HTTP_X_API_POP_KEY&#39;</span>] <span class="ruby-comment">#Get the customer header</span>
  <span class="ruby-ivar">@locale</span> = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&quot;HTTP_LOCALE&quot;] # Get client locale lang between en and fr</span>
  <span class="ruby-ivar">@ip_adresse</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span> <span class="ruby-comment"># Get customer remote IP</span>
  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;receive token : #{@token} from #{@ip_adresse}&quot;</span>
  <span class="ruby-ivar">@period</span>   = <span class="ruby-identifier">params</span>[<span class="ruby-value">:period</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@token</span>.<span class="ruby-identifier">present?</span>

    <span class="ruby-comment">#Search and identify customer token</span>
    <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>

      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-keyword">false</span>,
        <span class="ruby-value">message:</span> <span class="ruby-string">&quot;CUSTOMER NOT FOUND&quot;</span>
      }

    <span class="ruby-keyword">else</span>

      <span class="ruby-comment">#starting get customer history</span>
      <span class="ruby-identifier">request</span> = <span class="ruby-constant">Logstory</span><span class="ruby-operator">::</span><span class="ruby-constant">Histo</span>.<span class="ruby-identifier">h_customer</span>(<span class="ruby-ivar">@token</span>, <span class="ruby-ivar">@period</span>, <span class="ruby-ivar">@locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-identifier">request</span>[<span class="ruby-value">0</span>],
        <span class="ruby-value">message:</span> <span class="ruby-identifier">request</span>[<span class="ruby-value">1</span>]
      }

    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-keyword">false</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;customerNotFound&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
    }

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-historyByDate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">historyByDate</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CUSTOMER PERIOD HISTORY</p>

<pre>Permet de retourner le&#39;historique en fonction d&#39;une periode bien precise</pre>
          
          

          
          <div class="method-source-code" id="historyByDate-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">historyByDate</span>
  <span class="ruby-ivar">@token</span>    = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;HTTP_X_API_POP_KEY&#39;</span>]
  <span class="ruby-ivar">@locate</span>   = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&quot;HTTP_LOCALE&quot;]</span>
  <span class="ruby-ivar">@debut</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:begin</span>]
  <span class="ruby-ivar">@fin</span>      = <span class="ruby-identifier">params</span>[<span class="ruby-value">:end</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debut</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@fin</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debut</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@fin</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-keyword">false</span>,
        <span class="ruby-value">message:</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;sameDate&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>) <span class="ruby-comment">#&quot;Les dates sont identiques!&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">periode</span> = <span class="ruby-constant">Logstory</span><span class="ruby-operator">::</span><span class="ruby-constant">Histo</span>.<span class="ruby-identifier">h_interval</span>({<span class="ruby-value">token:</span> <span class="ruby-ivar">@token</span>, <span class="ruby-value">begin:</span> <span class="ruby-ivar">@debut</span>, <span class="ruby-value">end:</span> <span class="ruby-ivar">@fin</span>}, <span class="ruby-ivar">@locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>   <span class="ruby-identifier">periode</span>[<span class="ruby-value">0</span>],
          <span class="ruby-value">message:</span>  <span class="ruby-identifier">periode</span>[<span class="ruby-value">1</span>]
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-p" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">p</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RENDER HISTORY</p>

<pre class="ruby"><span class="ruby-ivar">@deprecated</span>
</pre>
          
          

          
          <div class="method-source-code" id="p-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">p</span>
  <span class="ruby-identifier">phone</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-identifier">query</span> = <span class="ruby-constant">History</span><span class="ruby-operator">::</span><span class="ruby-constant">History</span><span class="ruby-operator">::</span><span class="ruby-identifier">payment</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">message:</span> <span class="ruby-identifier">query</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-question" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">question</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RENDER QUESTIONS</p>

<pre class="ruby"><span class="ruby-identifier">gestion</span> <span class="ruby-identifier">des</span> <span class="ruby-identifier">questions</span> <span class="ruby-identifier">de</span> <span class="ruby-identifier">securité</span>
<span class="ruby-identifier">retourne</span> <span class="ruby-identifier">toutes</span> <span class="ruby-identifier">les</span> <span class="ruby-identifier">question</span> <span class="ruby-identifier">de</span> <span class="ruby-identifier">securité</span>  <span class="ruby-identifier">dispnible</span> <span class="ruby-identifier">sur</span> <span class="ruby-identifier">la</span> <span class="ruby-identifier">plateforme</span>
</pre>
          
          

          
          <div class="method-source-code" id="question-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">question</span>
  <span class="ruby-identifier">question</span> = <span class="ruby-constant">Question</span>.<span class="ruby-identifier">all</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
    <span class="ruby-value">message:</span> <span class="ruby-identifier">question</span>.<span class="ruby-identifier">as_json</span>(<span class="ruby-value">only:</span> [<span class="ruby-value">:id</span>, <span class="ruby-value">:content</span>])
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rechargeSprintPay" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rechargeSprintPay</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CREDIT PMQ WITH ORANGE MONEY | SPRINTPAY API</p>

<pre class="ruby"><span class="ruby-ivar">@return</span> [<span class="ruby-constant">Object</span>]
</pre>
          
          

          
          <div class="method-source-code" id="rechargeSprintPay-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 746</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rechargeSprintPay</span>
  <span class="ruby-comment"># phone         = params[:phone].to_i</span>
  <span class="ruby-identifier">token</span>         = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;HTTP_X_API_POP_KEY&#39;</span>]
  <span class="ruby-ivar">@phone</span>        = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-identifier">amount</span>        = <span class="ruby-identifier">params</span>[<span class="ruby-value">:amount</span>].<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">network_name</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-value">:network_name</span>].<span class="ruby-identifier">upcase</span>
  <span class="ruby-ivar">@ip</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>

  <span class="ruby-comment">#on verifie l&#39;existance de cet utilisateur</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-identifier">token</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span>   <span class="ruby-value">:not_found</span>,
      <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Customer not found&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># on effectuer le transfert via SP en se basant sur le network name</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">network_name</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;ORANGE&quot;</span>
      <span class="ruby-constant">SprintPay</span><span class="ruby-operator">::</span><span class="ruby-constant">Pay</span><span class="ruby-operator">::</span><span class="ruby-constant">Payment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-identifier">amount</span>)
      <span class="ruby-identifier">result</span> = <span class="ruby-constant">SprintPay</span><span class="ruby-operator">::</span><span class="ruby-constant">Pay</span><span class="ruby-operator">::</span><span class="ruby-constant">Payment</span>.<span class="ruby-identifier">orange</span>

      <span class="ruby-comment"># recuperation et application du callBack</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;statusDesc&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;FAILURE&quot;</span>
        <span class="ruby-comment"># echec de la transaction</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;statusDesc&quot;</span>],
            <span class="ruby-value">message:</span>  <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;description&quot;</span>],
            <span class="ruby-value">code:</span>     <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;statusCode&quot;</span>],
            <span class="ruby-value">motif:</span>    <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;motif&quot;</span>]
        }
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment"># tout de passe bien</span>

        <span class="ruby-comment"># on recupere le compte de l&#39;utilisateur courant</span>
        <span class="ruby-identifier">account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span> <span class="ruby-comment">#Account.find_by_customer_id(customer.id)</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">blank?</span>
          <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
              <span class="ruby-value">status:</span>   <span class="ruby-value">:not_found</span>,
              <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Compte inconnu ou inexistant&quot;</span>
          }
        <span class="ruby-keyword">else</span>
          <span class="ruby-comment"># le compte existe, on peut continuer le traitement</span>
          <span class="ruby-identifier">pp_amount</span> = <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;amount&quot;</span>].<span class="ruby-identifier">to_f</span>

          <span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">pp_amount</span>

          <span class="ruby-comment"># on met a jour le compte du customer du noveau montant recu</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span>)

            <span class="ruby-comment"># Ecriture de l&#39;historique</span>

            <span class="ruby-identifier">h</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
                <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>,
                <span class="ruby-value">amount:</span> <span class="ruby-identifier">amount</span>,
                <span class="ruby-value">code:</span> <span class="ruby-ivar">@hash</span>,
                <span class="ruby-value">flag:</span> <span class="ruby-string">&quot;recharge&quot;</span>.<span class="ruby-identifier">upcase</span>,
                <span class="ruby-value">context:</span> <span class="ruby-string">&quot;Mobile&quot;</span>.<span class="ruby-identifier">upcase</span>,
                <span class="ruby-value">ip:</span> <span class="ruby-ivar">@ip</span>
            )
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">h</span>.<span class="ruby-identifier">save</span> <span class="ruby-comment">#Parametre::PersonalData.getHistorique(customer.id, @hash, amount, &quot;RECHARGE VIA #{network_name.upcase}&quot;) == true</span>
              <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Recharge de votre compte d&#39;un montant de #{amount} F CFA depuis #{network_name}. Nouveau solde : #{account.amount} F CFA&quot;</span>)

              <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
                  <span class="ruby-value">status:</span>   <span class="ruby-value">:success</span>,
                  <span class="ruby-value">message:</span>  <span class="ruby-node">&quot;Votre compte PayMeQuick a ete credité d&#39;un montant de #{result[&quot;amount&quot;]} depuis #{network_name}&quot;</span>
              }
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
                  <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
                  <span class="ruby-value">message:</span>  <span class="ruby-node">&quot;Impossible de recharger votre compte PayMeQuick d&#39;un montant de #{result[&quot;amount&quot;]} depuis #{network_name} =&gt; erreurs : #{result}&quot;</span>
              }
            <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span>
               {
                   <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
                   <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Impossible de mettre a jour votre compte&quot;</span>
                   <span class="ruby-comment">#Lancer le processus de  rollBack de montant precedement debité</span>
               }
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;MTN&quot;</span>
      <span class="ruby-comment"># Paiement par MTN MOMO</span>

      <span class="ruby-constant">SprintPay</span><span class="ruby-operator">::</span><span class="ruby-constant">Pay</span><span class="ruby-operator">::</span><span class="ruby-constant">Payment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@phone</span>, <span class="ruby-identifier">amount</span>)
      <span class="ruby-identifier">result</span> = <span class="ruby-constant">SprintPay</span><span class="ruby-operator">::</span><span class="ruby-constant">Pay</span><span class="ruby-operator">::</span><span class="ruby-constant">Payment</span>.<span class="ruby-identifier">mtn</span>

      <span class="ruby-comment"># recuperation et application du callBack</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;statusDesc&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;FAILURE&quot;</span>
        <span class="ruby-comment"># echec de la transaction</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;statusDesc&quot;</span>],
            <span class="ruby-value">message:</span>  <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;description&quot;</span>],
            <span class="ruby-value">code:</span>     <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;statusCode&quot;</span>],
            <span class="ruby-value">motif:</span>    <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;motif&quot;</span>]
        }
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment"># tout de passe bien</span>

        <span class="ruby-comment"># on recupere le compte de l&#39;utilisateur courant</span>
        <span class="ruby-identifier">account</span> = <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">account</span> <span class="ruby-comment">#Account.find_by_customer_id(customer.id)</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">blank?</span>
          <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
              <span class="ruby-value">status:</span>   <span class="ruby-value">:not_found</span>,
              <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Compte inconnu&quot;</span>
          }
        <span class="ruby-keyword">else</span>
          <span class="ruby-comment"># le compte existe, on peut continuer le traitement</span>
          <span class="ruby-identifier">pp_amount</span> = <span class="ruby-identifier">result</span>[<span class="ruby-string">&quot;amount&quot;</span>]

          <span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">pp_amount</span>

          <span class="ruby-comment"># on met a jour le compte du customer du noveau montant recu</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">amount:</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">amount</span>)
            <span class="ruby-identifier">h</span> = <span class="ruby-constant">History</span>.<span class="ruby-identifier">new</span>(
                <span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>,
                <span class="ruby-value">amount:</span> <span class="ruby-identifier">amount</span>,
                <span class="ruby-value">code:</span> <span class="ruby-ivar">@hash</span>,
                <span class="ruby-value">flag:</span> <span class="ruby-string">&quot;recharge&quot;</span>.<span class="ruby-identifier">upcase</span>,
                <span class="ruby-value">context:</span> <span class="ruby-string">&quot;Mobile&quot;</span>.<span class="ruby-identifier">upcase</span>,
                <span class="ruby-value">ip:</span> <span class="ruby-ivar">@ip</span>
            )
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">h</span>.<span class="ruby-identifier">save</span> <span class="ruby-comment">#Parametre::PersonalData.getHistorique(customer.id, @hash, amount, &quot;RECHARGE VIA #{network_name.upcase}&quot;) == true</span>
              <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;Recharge de votre compte d&#39;un montant de #{amount} F CFA depuis #{network_name}. Nouveau solde : #{account.amount} F CFA&quot;</span>)

              <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
                  <span class="ruby-value">status:</span>   <span class="ruby-value">:success</span>,
                  <span class="ruby-value">message:</span>  <span class="ruby-node">&quot;Votre compte PayMeQuick a ete credité d&#39;un montant de #{result[&quot;amount&quot;]} depuis #{network_name}&quot;</span>
              }
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
                  <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
                  <span class="ruby-value">message:</span>  <span class="ruby-node">&quot;Impossible de recharger votre compte PayMeQuick d&#39;un montant de #{result[&quot;amount&quot;]} depuis #{network_name} : Erreurs : #{result}&quot;</span>
              }
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span>
               {
                   <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
                   <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Impossible de mettre a jour votre compte&quot;</span>
               }
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;NEXTTEL&quot;</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
          <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Pas encore supporté&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
          <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Opérateur pas encore supporté&quot;</span>
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-resetPassword" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">resetPassword</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RESET CUSTOMER PASSWORD</p>

<pre class="ruby"><span class="ruby-identifier">permet</span>  <span class="ruby-identifier">de</span> <span class="ruby-identifier">reset</span> <span class="ruby-identifier">le</span> <span class="ruby-identifier">password</span>
</pre>
          
          

          
          <div class="method-source-code" id="resetPassword-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 502</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">resetPassword</span>
  <span class="ruby-identifier">code</span>                  = <span class="ruby-identifier">params</span>[<span class="ruby-value">:code_sms</span>]
  <span class="ruby-identifier">phone</span>                 = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-identifier">password</span>              = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]

  <span class="ruby-comment"># on cherche a verifier le code</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span> <span class="ruby-value">:not_found</span>,
      <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># on commence par rechercher si le customer en question a demander a reinitialiser son pwd</span>
    <span class="ruby-identifier">checkCode</span> = <span class="ruby-constant">SmsPassword</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">code:</span> <span class="ruby-identifier">code</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">checkCode</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-value">:not_found</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Pas de code pour cet utilisateur&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># deblocage du user</span>
      <span class="ruby-identifier">unlock</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">SecurityQuestion</span><span class="ruby-operator">::</span><span class="ruby-identifier">unlockCustomerAccount</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">unlock</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">password:</span> <span class="ruby-identifier">password</span>)

          <span class="ruby-comment"># on supprimer les anciennes informations</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">checkCode</span>.<span class="ruby-identifier">destroy</span>
            <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-string">&quot;Votre mot de passe vient d etre mis a jour si vous n en etes pas l auteur, veillez vous rapprocher d un agence partenaire. PAYQUICK&quot;</span>)
            <span class="ruby-comment">#render data to json</span>
            <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
              <span class="ruby-value">status:</span>   <span class="ruby-value">:success</span>,
              <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Mot de passe mis a jour&quot;</span>
            }
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#render data to json</span>
            <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
              <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
              <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Impossible de mettre le mot de passe a jour&quot;</span>,
              <span class="ruby-value">errors:</span>   <span class="ruby-identifier">checkCode</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>
            }
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">:error</span>,
            <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Impossible de mettre le mot de passe jour&quot;</span>
          }
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>   <span class="ruby-value">:errors</span>,
          <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Mise à jour d&#39;informations d&#39;authetification impossible&quot;</span>
        }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-retrivePassword" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">retrivePassword</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RECUPERATION DU CUSTOMER PASSWORD</p>

<pre>recuperation du mot de passe perdu/oublié par le customer</pre>
          
          

          
          <div class="method-source-code" id="retrivePassword-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 443</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">retrivePassword</span>
  <span class="ruby-identifier">question</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-value">:question_id</span>]
  <span class="ruby-identifier">answer</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:reponse</span>]
  <span class="ruby-identifier">phone</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]

  <span class="ruby-ivar">@sms_pwd</span> = <span class="ruby-identifier">rand</span>(<span class="ruby-value">6</span><span class="ruby-operator">**</span><span class="ruby-value">6</span>)

  <span class="ruby-comment"># on recherche si ce numero de telephone est enregistré dans la plateforme</span>
  <span class="ruby-identifier">customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_phone</span>(<span class="ruby-identifier">phone</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span> <span class="ruby-value">:not_found</span>,
      <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">answer</span> = <span class="ruby-constant">Answer</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">question_id:</span> <span class="ruby-identifier">question</span>, <span class="ruby-value">content:</span> <span class="ruby-identifier">answer</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;#{answer.inspect}&quot;</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-value">:not_found</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-node">&quot;Resultat non coherent pour l&#39;utilisateur #{phone}&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># avant l&#39;envoi, on bloque le compte du customer</span>
      <span class="ruby-identifier">lock</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">SecurityQuestion</span><span class="ruby-operator">::</span><span class="ruby-identifier">lockCustomerAccount</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>)

      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Valeur de Lock :: #{lock.inspect}&quot;</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">lock</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> 
        <span class="ruby-comment"># on enregistre le code SMS</span>
        <span class="ruby-identifier">sms_code</span> = <span class="ruby-constant">SmsPassword</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">customer_id:</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">code:</span> <span class="ruby-ivar">@sms_pwd</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">sms_code</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-comment"># on incremente le compte status</span>

          <span class="ruby-comment">#le compte vient d&#39;etre bloqué</span>
          <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-node">&quot;SMS Validation mot de passe #{@sms_pwd}&quot;</span>)
          <span class="ruby-constant">Sms</span><span class="ruby-operator">::</span><span class="ruby-identifier">send</span>
          <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">:found</span>,
            <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Verifier votre messagerie SMS.&quot;</span>
          }
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">:errors</span>,
            <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Une erreur est survenue&quot;</span>
          }
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>   <span class="ruby-value">:error_lock</span>,
          <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Impossible de verrouiller le compte&quot;</span>
        }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-service" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">service</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RENDER SERVICE FROM CATEGORIES</p>
          
          

          
          <div class="method-source-code" id="service-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">service</span>

  <span class="ruby-identifier">id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-identifier">services</span> = <span class="ruby-constant">Service</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">cat_id:</span> <span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">services:</span> <span class="ruby-identifier">services</span>
  }

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-serviceCategorie" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">serviceCategorie</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>RENDER CATEGORIES</p>
          
          

          
          <div class="method-source-code" id="serviceCategorie-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">serviceCategorie</span>
  <span class="ruby-identifier">categorie</span> = <span class="ruby-constant">Cat</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">name:</span> <span class="ruby-value">:asc</span>)
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">categories:</span> <span class="ruby-identifier">categorie</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-signin" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">signin</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>AUTHENTICATE CUSTOMER</p>
          
          

          
          <div class="method-source-code" id="signin-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 239</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">signin</span>
  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Starting signin process ...&quot;</span>
  <span class="ruby-identifier">phone</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-identifier">device</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:uuid</span>]
  <span class="ruby-identifier">locale</span> = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&quot;HTTP_LOCALE&quot;]</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">phone</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">password</span>.<span class="ruby-identifier">present?</span>

    <span class="ruby-comment">#query the user</span>
    <span class="ruby-identifier">signin</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">signin</span>({<span class="ruby-value">phone:</span> <span class="ruby-identifier">phone</span>, <span class="ruby-value">password:</span> <span class="ruby-identifier">password</span>, <span class="ruby-value">device:</span> <span class="ruby-identifier">device</span>}, <span class="ruby-identifier">locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>], <span class="ruby-string">&quot;Authentification&quot;</span>)
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Login data response : #{signin}&quot;</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> <span class="ruby-identifier">signin</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span> <span class="ruby-value">:missing_parameters</span>,
        <span class="ruby-value">message:</span> <span class="ruby-string">&quot;PARAMETRES MANQUANT&quot;</span>
    }

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-signup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">signup</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>CREATE CUSTOMER ACCOUNTpassword</p>

<pre class="ruby"><span class="ruby-ivar">@return</span> [<span class="ruby-constant">Object</span>]
</pre>
          
          

          
          <div class="method-source-code" id="signup-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 9</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">signup</span>
  <span class="ruby-ivar">@ip</span>             = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
  <span class="ruby-ivar">@name</span>           = <span class="ruby-identifier">params</span>[<span class="ruby-value">:nom</span>]
  <span class="ruby-ivar">@second_name</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:second_name</span>]
  <span class="ruby-ivar">@tel</span>            = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-comment">#@cni            = params[:cni]</span>
  <span class="ruby-ivar">@password</span>       = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-ivar">@sexe</span>           = <span class="ruby-identifier">params</span>[<span class="ruby-value">:sexe</span>]
  <span class="ruby-ivar">@question_id</span>    = <span class="ruby-identifier">params</span>[<span class="ruby-value">:question_id</span>]
  <span class="ruby-ivar">@response</span>       = <span class="ruby-identifier">params</span>[<span class="ruby-value">:reponse</span>]

  <span class="ruby-comment">#adding locale I18n</span>
  <span class="ruby-ivar">@locale</span>         = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&quot;HTTP_LOCALE&quot;]</span>

  <span class="ruby-comment">#données elementaire de base</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@tel</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@question_id</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@password</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@name</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@ip</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@sexe</span>.<span class="ruby-identifier">present?</span>

    <span class="ruby-identifier">query</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">signup</span>({<span class="ruby-value">name:</span> <span class="ruby-ivar">@name</span>, <span class="ruby-value">second_name:</span> <span class="ruby-ivar">@second_name</span>, <span class="ruby-value">phone:</span> <span class="ruby-ivar">@tel</span>, <span class="ruby-value">password:</span> <span class="ruby-ivar">@password</span>, <span class="ruby-value">sexe:</span> <span class="ruby-ivar">@sexe</span>, <span class="ruby-value">question:</span> <span class="ruby-ivar">@question_id</span>, <span class="ruby-value">answer:</span> <span class="ruby-ivar">@response</span>, <span class="ruby-value">ip:</span> <span class="ruby-ivar">@ip</span>}, <span class="ruby-string">&quot;create customer account&quot;</span>, <span class="ruby-ivar">@locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span> <span class="ruby-identifier">query</span>
    }

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">satus:</span> <span class="ruby-value">:false</span>,
      <span class="ruby-value">message:</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;DataNotComplete&quot;</span>, <span class="ruby-value">locale:</span> <span class="ruby-ivar">@locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>]) <span class="ruby-comment">#&quot;Centaines informations sont manquantes&quot;</span>
    }

  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-signup_authentication" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">signup_authentication</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>VALIDATE SIGNUP SMS AUTHENTICATION WITH ONE TIME PASSWORD</p>

<pre>validation de 2FA</pre>
          
          

          
          <div class="method-source-code" id="signup_authentication-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 409</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">signup_authentication</span>
  <span class="ruby-identifier">phone</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-identifier">code</span>      = <span class="ruby-identifier">params</span>[<span class="ruby-value">:code</span>]
  <span class="ruby-ivar">@playerId</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:playerId</span>]

  <span class="ruby-identifier">authenticate</span> = <span class="ruby-constant">Parametre</span><span class="ruby-operator">::</span><span class="ruby-constant">Authentication</span><span class="ruby-operator">::</span><span class="ruby-identifier">validate_otp</span>(<span class="ruby-identifier">phone</span>, <span class="ruby-identifier">code</span>, <span class="ruby-ivar">@playerId</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">authenticate</span>[<span class="ruby-value">0</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span> <span class="ruby-value">:success</span>,
      <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Authentifié&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span> <span class="ruby-value">:failed</span>,
      <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Echec authentification&quot;</span>
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-solde" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">solde</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>obtention du solde du compte client</p>
          
          

          
          <div class="method-source-code" id="solde-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">solde</span>
  <span class="ruby-ivar">@token</span>      = <span class="ruby-identifier">params</span>[<span class="ruby-value">:customer</span>]
  <span class="ruby-ivar">@pwd</span>        = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-ivar">@playerId</span>   = <span class="ruby-identifier">params</span>[<span class="ruby-value">:playerId</span>]
  <span class="ruby-identifier">locale</span> = <span class="ruby-string">&quot;fr&quot;</span> <span class="ruby-comment">#request.headers[&quot;HTTP_LOCALE&quot;]</span>

  <span class="ruby-comment">#check all datas available</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@token</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pwd</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@playerId</span>.<span class="ruby-identifier">present?</span>

    <span class="ruby-comment">#recherche du phone</span>
    <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentification_token</span>(<span class="ruby-ivar">@token</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Utilisateur inconnu sur la plateforme&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_balance</span>({<span class="ruby-value">phone:</span> <span class="ruby-ivar">@customer</span>, <span class="ruby-value">password:</span> <span class="ruby-ivar">@pwd</span>}, <span class="ruby-identifier">locale</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">balance</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">message:</span> <span class="ruby-ivar">@customer</span>
        }
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">message:</span> <span class="ruby-string">&quot;compte vide&quot;</span>
        }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">status:</span>   <span class="ruby-keyword">false</span>,
        <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Certaines informations sont manquantes&quot;</span>
    }

  <span class="ruby-keyword">end</span>


<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-testNetwork" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">testNetwork</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test de la connxino internet</p>
          
          

          
          <div class="method-source-code" id="testNetwork-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 989</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">testNetwork</span>
  <span class="ruby-comment">#ApiMailer.sendAdmin(&quot;lorem&quot;).deliver_now!</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-transaction" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">transaction</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="transaction-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transaction</span>
    <span class="ruby-identifier">from</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:payeur</span>]
    <span class="ruby-identifier">to</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:receveur</span>]
    <span class="ruby-identifier">amount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:montant</span>]
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]

    <span class="ruby-identifier">transaction</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>, <span class="ruby-identifier">amount</span>, <span class="ruby-identifier">password</span>)
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> <span class="ruby-identifier">transaction</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-updateAccount" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">updateAccount</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Mise a jour des informations du compte utilisateur</p>
          
          

          
          <div class="method-source-code" id="updateAccount-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 940</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">updateAccount</span>
  <span class="ruby-comment">#@header       = request.headers[&#39;HTTP_X_API_POP_KEY&#39;]</span>
  <span class="ruby-ivar">@token</span>        = <span class="ruby-identifier">params</span>[<span class="ruby-value">:token</span>]
  <span class="ruby-ivar">@name</span>         = <span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>]
  <span class="ruby-ivar">@second_name</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-value">:second_name</span>]
  <span class="ruby-ivar">@sexe</span>         = <span class="ruby-identifier">params</span>[<span class="ruby-value">:sexe</span>]
  <span class="ruby-ivar">@password</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>]
  

  <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Utilisateur Inconnu&quot;</span>
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@password</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">name:</span> <span class="ruby-ivar">@name</span>, <span class="ruby-value">second_name:</span> <span class="ruby-ivar">@second_name</span>, <span class="ruby-value">sexe:</span> <span class="ruby-ivar">@sexe</span>, <span class="ruby-value">password:</span> <span class="ruby-ivar">@password</span>)
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">:success</span>,
            <span class="ruby-value">flag:</span>     <span class="ruby-value">:data_updated</span>,
            <span class="ruby-value">message:</span>  <span class="ruby-string">&quot;Profil mis a jour&quot;</span>
        }
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
            <span class="ruby-value">flag:</span>     <span class="ruby-value">:data_not_updated</span>,
            <span class="ruby-value">message:</span> <span class="ruby-node">&quot;Impossible de faire la mise a jour : #{@customer.errors.full_messages}&quot;</span>
        }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># mise a jour du profile sans mot de passe</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">name:</span> <span class="ruby-ivar">@name</span>, <span class="ruby-value">second_name:</span> <span class="ruby-ivar">@second_name</span>, <span class="ruby-value">sexe:</span> <span class="ruby-ivar">@sexe</span>)
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">:success</span>,
            <span class="ruby-value">flag:</span>     <span class="ruby-value">:data_updated</span>,
            <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Profil personnel et mote de passe mis a jour&quot;</span>
        }
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span>   <span class="ruby-value">:failed</span>,
            <span class="ruby-value">flag:</span>     <span class="ruby-value">:data_not_updated</span>,
            <span class="ruby-value">message:</span> <span class="ruby-node">&quot;Impossible de faire la mise a jour : #{@customer.errors.full_messages}&quot;</span>
        }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-updatePassword" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">updatePassword</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>UPDATE CUSTOMER PASSWORD ACCOUNT</p>

<pre class="ruby"><span class="ruby-constant">Mettre</span> <span class="ruby-identifier">a</span> <span class="ruby-identifier">jour</span> <span class="ruby-identifier">son</span> <span class="ruby-identifier">mot</span> <span class="ruby-identifier">de</span> <span class="ruby-identifier">passe</span>
</pre>
          
          

          
          <div class="method-source-code" id="updatePassword-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 678</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">updatePassword</span>
  <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Starting caal method for renewing password&quot;</span>
  <span class="ruby-ivar">@token</span>          = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;HTTP_X_API_POP_KEY&quot;</span>]
  <span class="ruby-ivar">@previouPwd</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-value">:hold_pass</span>] <span class="ruby-comment"># Ancien mot de passe</span>
  <span class="ruby-ivar">@newPwd</span>         = <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_pass</span>] <span class="ruby-comment"># Nouveau mot de passe</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@token</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@previouPwd</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@newPwd</span>.<span class="ruby-identifier">present?</span>

    <span class="ruby-comment">#on recherch le client sur la base de son token</span>
    <span class="ruby-ivar">@customer</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find_by_authentication_token</span>(<span class="ruby-ivar">@token</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;User is unknow&quot;</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>     <span class="ruby-keyword">false</span>,
          <span class="ruby-value">flag:</span>       <span class="ruby-value">:cunstomer_not_found</span>,
          <span class="ruby-value">message:</span>    <span class="ruby-string">&quot;Utilisateur inconnu&quot;</span>
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#tout va bien on verifie que c&#39;est bien le @previeouPwd</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">valid_password?</span>(<span class="ruby-ivar">@previouPwd</span>)
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;User is valid&quot;</span>
        <span class="ruby-comment">#tout va bien, on peut continuer en chageant les informations sur le mot de passe</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">password:</span> <span class="ruby-ivar">@newPwd</span>, <span class="ruby-value">authentication_token:</span> <span class="ruby-keyword">nil</span>)

          <span class="ruby-comment">#on notifie le gar que tout c&#39;est bien passé</span>
          <span class="ruby-comment">#Notification SMS</span>
          <span class="ruby-constant">Sms</span>.<span class="ruby-identifier">sender</span>(<span class="ruby-ivar">@customer</span>.<span class="ruby-identifier">phone</span>, <span class="ruby-string">&quot;Votre mot de passe a ete mis a jour, merci de vous reconnecter. PayMeQuick&quot;</span>)

          <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span> <span class="ruby-keyword">true</span>,
            <span class="ruby-value">flag:</span> <span class="ruby-value">:password_updated</span>,
            <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Votre mot de passe a ete mis a jour. Merci de vous reconnecter a PayMeQuick&quot;</span>
          }

        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Failed to update password&quot;</span>
          <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
            <span class="ruby-value">status:</span> <span class="ruby-keyword">false</span>,
            <span class="ruby-value">flag:</span> <span class="ruby-value">:password_not_updated</span>,
            <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Impossible de mettre à jour votre mot de passe&quot;</span>
          }

        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Rails</span><span class="ruby-operator">::</span><span class="ruby-identifier">logger</span><span class="ruby-operator">::</span><span class="ruby-identifier">info</span> <span class="ruby-string">&quot;User is invalid&quot;</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">status:</span>     <span class="ruby-value">404</span>,
          <span class="ruby-value">flag:</span>       <span class="ruby-value">:password_no_match</span>,
          <span class="ruby-value">message:</span>    <span class="ruby-string">&quot;Impossible de vous identifier&quot;</span>
        }
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">else</span>

    <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
      <span class="ruby-value">status:</span> <span class="ruby-keyword">false</span>,
      <span class="ruby-value">flag:</span>   <span class="ruby-string">&quot;Some parametres are misssing&quot;</span>,
      <span class="ruby-value">message:</span> <span class="ruby-string">&quot;Données invalides ou manquantes&quot;</span>,
      <span class="ruby-value">params:</span> <span class="ruby-node">&quot;#{@token}, #{@previouPwd}, #{@newPwd}&quot;</span>
    }

  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validate_retrait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_retrait</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>VALIDATE CUSTOMER INTENT RETRAIT</p>
          
          

          
          <div class="method-source-code" id="validate_retrait-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 387</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validate_retrait</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>])
    
    <span class="ruby-comment">#header = request.headers[&#39;HTTP_X_API_POP_KEY&#39;]</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:token</span>]

    <span class="ruby-identifier">request</span> = <span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-identifier">validate_retrait</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">password</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">request</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
          <span class="ruby-value">code:</span> <span class="ruby-identifier">request</span>[<span class="ruby-value">0</span>],
          <span class="ruby-value">message:</span> <span class="ruby-identifier">request</span>[<span class="ruby-value">1</span>]
        }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> {
        <span class="ruby-value">code:</span> <span class="ruby-identifier">request</span>[<span class="ruby-value">0</span>],
        <span class="ruby-value">message:</span> <span class="ruby-identifier">request</span>[<span class="ruby-value">1</span>]
      }
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-virtualSP" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">virtualSP</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>mise en oeuvre du virtual SprintPayLocalAPI</p>
          
          

          
          <div class="method-source-code" id="virtualSP-source">
            <pre><span class="ruby-comment"># File app/controllers/api/v1/session_controller.rb, line 633</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">virtualSP</span>
  <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:token</span>]
  <span class="ruby-ivar">@phone</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone</span>]
  <span class="ruby-ivar">@amount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:amount</span>]
  <span class="ruby-identifier">network_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:network_name</span>]

  <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Vistual SP activated ...&quot;</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">json:</span> <span class="ruby-constant">SprintPay</span><span class="ruby-operator">::</span><span class="ruby-constant">Pay</span><span class="ruby-operator">::</span><span class="ruby-constant">Payment</span>.<span class="ruby-identifier">sp</span>(<span class="ruby-ivar">@token</span>, <span class="ruby-ivar">@phone</span>, <span class="ruby-ivar">@amount</span>, <span class="ruby-identifier">network_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.0.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

